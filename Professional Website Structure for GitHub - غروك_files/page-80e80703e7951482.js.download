!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="2d20dc65-5a3a-47c2-8a90-7854d9862a23",e._sentryDebugIdIdentifier="sentry-dbid-2d20dc65-5a3a-47c2-8a90-7854d9862a23")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[41340],{38245:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var a=s(79342),l=s(28503),i=s(10953),n=s(32171),r=s.n(n),o=s(65146);function d(){let{t:e}=(0,o.Bd)("base");return(0,a.jsxs)("div",{className:"w-full min-h-dvh flex flex-col items-center justify-center pt-4",children:[(0,a.jsx)("div",{className:"fixed bgGradient w-screen h-dvh -z-10"}),(0,a.jsx)(r(),{href:"/",className:"block focus:outline-none focus-visible:ring-1 focus-visible:ring-ring rounded-lg",children:(0,a.jsx)(i.r1,{height:20,width:60,className:"opacity-80 hover:opacity-100 fill-black dark:fill-white"})}),(0,a.jsx)(l.J,{title:e("pages.404.title","Page not found"),description:e("pages.404.description","There was an error loading this page. Please verify that you are using a correct URL or contact one of the admins if the issue persists."),cta:e("pages.404.home","Return to home")})]})}},40865:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>sE});var a=s(79342),l=s(51375),i=s(37469),n=s(65761),r=s(56691),o=s(61312),d=s(87891),c=s(20337),u=s(42283),m=s(77010),f=s(33846),x=s(74995),p=s(88382),g=s(65146),h=s(97325);let v=(0,p.memo)(e=>{let{asset:t,isFileSelected:s}=e,{t:v}=(0,g.Bd)(),{client:j}=(0,c.useStatsigClient)(),b=(0,h.aP)(x.A("setSidePanelContent")),[y,I]=(0,p.useState)(!1),w=(0,d.R)(e=>e.deleteAsset),k=(0,p.useCallback)(()=>{if(s)return void b(void 0);b({type:"asset",data:(0,i.B)(t),hideEdit:!0})},[t,s,b]),N=(0,p.useCallback)(e=>{var s,a;e.stopPropagation(),w(t.assetId),j.logEvent("delete_asset","asset_row",{assetId:t.assetId,assetName:t.name,assetSize:null!=(a=null==(s=t.sizeBytes)?void 0:s.toString())?a:"unknown",assetType:t.mimeType})},[t,w,j]);return(0,a.jsxs)(f.P.div,{layout:!0,initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:(0,o.cn)("flex flex-shrink-0 items-center gap-4 p-2 border rounded-xl bg-card hover:bg-card-hover cursor-pointer focus:bg-card-hover focus:outline-none mb-2 overflow-x-hidden",s&&"bg-card-hover"),tabIndex:0,onClick:k,children:[(0,a.jsx)(l.E,{metadata:(0,i.B)(t),className:"rounded-lg w-12 h-12 ms-0 me-0 [&>img]:h-full [&>img]:w-full"}),(0,a.jsxs)("div",{className:"flex flex-col flex-1",children:[(0,a.jsx)("span",{className:"line-clamp-1 break-all",children:t.name}),(0,a.jsxs)("div",{className:"text-sm text-gray-500 line-clamp-1 break-all",children:[(0,a.jsx)("span",{children:t.sizeBytes?function(e){let t=Math.floor(Math.log(e)/Math.log(1e3));return(e/Math.pow(1024,t)).toFixed(2)+" "+["B","KB","MB","GB","TB"][t]}(t.sizeBytes):v("file-browser.unknown-size","Unknown")}),(0,a.jsx)("span",{children:" • "}),(0,a.jsx)("span",{children:t.createTime?(0,n.P)(t.createTime):""}),(0,a.jsx)("span",{children:" • "}),(0,a.jsx)("span",{children:t.mimeType})]})]}),y?(0,a.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,a.jsx)(r.gx,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),I(!1)},tooltipContent:v("Cancel","Cancel"),"aria-label":v("Cancel","Cancel"),className:"flex items-center gap-3 size-8 rounded-md",children:(0,a.jsx)(u.A,{size:16})}),(0,a.jsx)(r.gx,{variant:"ghost",size:"sm",btnColor:"danger",onClick:N,tooltipContent:v("Confirm","Confirm"),"aria-label":v("Confirm","Confirm"),className:"flex items-center gap-3 size-8 rounded-md",children:(0,a.jsx)(m.A,{size:16})})]}):(0,a.jsx)(r.gx,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),I(!0)},tooltipContent:v("Delete","Delete"),"aria-label":v("Delete","Delete"),className:"flex items-center gap-3 size-8 rounded-md",children:(0,a.jsx)(m.A,{size:16})})]},t.assetId)});var j=s(81745),b=s(28503),y=s(54344),I=s(80095),w=s(73772),k=s(74933),N=s(48589),C=s(84499);function S(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";throw Error(e)}function A(e){return null!=e}var E=s(5335);let z=(0,E.A)("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);var R=s(67811),M=s(57402),P=s(84969),T=s(63209),D=s(56115),_=s(17703);let B=()=>{let{route:e}=(0,C.wK)(),t=(0,d.R)(e=>e.loadFirstPage),s=(0,d.R)(e=>e.loadNextPage),a=(0,d.R)(e=>e.listPageToken),l=(0,d.R)(e=>e.listStatus),i=(0,d.Z0)();(0,p.useEffect)(()=>{t({sort:"files"===e.page?e.sort:"used",search:"files"===e.page?e.search:void 0})},[t,e]);let{loadMoreRef:n,historyContainerRef:r}=(0,D.R)({hasNextPage:!!a,isFetchingNextPage:"loading"===l,isLoading:"loading"===l,fetchNextPage:()=>{s().catch(e=>(0,_.vV)("files-load-more",e))}});return{assets:i,isLoading:"loading"===l,hasError:"error"===l,refetch:t,loadMoreRef:n,historyContainerRef:r}},O=[{label:(0,a.jsx)(g.x6,{ns:"base",i18nKey:"file-browser.sort.size",defaults:"Size"}),value:"size"},{label:(0,a.jsx)(g.x6,{ns:"base",i18nKey:"file-browser.sort.name",defaults:"Name"}),value:"name"},{label:(0,a.jsx)(g.x6,{ns:"base",i18nKey:"file-browser.sort.created-time",defaults:"Created Time"}),value:"created"},{label:(0,a.jsx)(g.x6,{ns:"base",i18nKey:"file-browser.sort.last-used-time",defaults:"Last Used Time"}),value:"used"}];function U(){var e;let{t}=(0,g.Bd)("base"),{user:s}=(0,I.useSession)(),{push:l,replace:i,route:n}=(0,C.wK)(),d="files"===n.page?n:S("only for /files"),[c,u]=(0,p.useState)(""),m=d.sort||"used",x=(0,N.o)(c,500);(0,p.useEffect)(()=>{i({...d,search:x})},[x,i,d]);let A=e=>{l({...d,sort:e})},E=(0,h.aP)(e=>{var t;return(null==(t=e.sidePanelContent)?void 0:t.type)!=="asset"?null:e.sidePanelContent.data.fileMetadataId}),{assets:D,isLoading:_,hasError:U,refetch:F,loadMoreRef:L,historyContainerRef:W}=B();return s?(0,a.jsxs)("main",{className:(0,o.cn)("h-dvh w-full relative flex flex-col items-center"),children:[(0,a.jsx)(T.hx,{hideIncognito:!0}),(0,a.jsx)(j.CommandMenu,{}),(0,a.jsxs)("div",{className:"max-w-[50rem] px-2 pt-16 pb-8 @sm:pt-18 mx-auto w-full flex flex-col h-full",ref:W,children:[(0,a.jsxs)("h1",{className:"text-2xl flex gap-2 items-center pb-4",children:[(0,a.jsx)(z,{size:24,className:"min-w-8"}),t("Files","Files")]}),(0,a.jsxs)("div",{className:"flex gap-2 items-center justify-between w-full pb-2",children:[(0,a.jsx)(k.p,{value:c,onChange:e=>u(e.target.value),placeholder:t("file-browser.filter.placeholder","Search files..."),className:"text-primary bg-input h-10 rounded-xl"}),(0,a.jsxs)(w.rI,{children:[(0,a.jsx)(w.ty,{asChild:!0,children:(0,a.jsxs)(r.$n,{variant:"outline",className:"h-10 rounded-xl",children:[t("file-browser.sort.label","Sort by: "),null==(e=O.find(e=>e.value===m))?void 0:e.label,(0,a.jsx)(R.A,{size:16})]})}),(0,a.jsx)(w.SQ,{children:O.map(e=>(0,a.jsx)(w._2,{onClick:()=>A(e.value),children:e.label},e.value))})]})]}),(0,a.jsxs)(y.D,{children:[(0,a.jsxs)(P.N,{children:[null==D?void 0:D.map(e=>(0,a.jsx)(v,{isFileSelected:e.assetId===E,asset:e},e.assetId)),(null==D?void 0:D.length)===0&&!_&&(0,a.jsx)(f.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:(0,a.jsx)("div",{className:"text-center",children:t("file-browser.no-files-found","No files found")})},"no-files-found"),_&&(0,a.jsx)("div",{className:"flex justify-center items-center w-full h-full max-h-[150px]",children:(0,a.jsx)(f.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)(M.A,{className:"animate-spin"})})})},"files-loading"),U&&(0,a.jsxs)("div",{className:"flex justify-center items-center w-full h-full max-h-[150px] flex-col gap-4",children:[(0,a.jsx)("div",{className:"text-center",children:t("file-browser.error.description","There was an issue loading your files")}),(0,a.jsx)(r.$n,{variant:"filledSecondary",onClick:()=>F(),children:t("Retry","Retry")})]},"files-error")]}),(0,a.jsx)("div",{ref:L})]})]})]}):(0,a.jsx)("main",{className:(0,o.cn)("w-screen h-dvh relative"),children:(0,a.jsx)(b.J,{title:t("Error","Error"),description:t("file-browser.error.anonymous-user","You must be logged in to access this page"),cta:t("Go Home","Go Home")})})}var F=s(38245),L=s(75500),W=s(92437),H=s(14908);function V(e){let{className:t}=e,{t:s}=(0,g.Bd)("files"),l=(0,p.useRef)(null),i=(0,d.R)(e=>e.uploadAsset),{push:n}=(0,C.wK)(),r=(0,p.useCallback)((e,t)=>{let a=t.items;if(!a||0===a.length||!("webkitGetAsEntry"in a[0]))return void e.forEach(e=>i(e));let l=e=>{".DS_Store"!==e.name&&i(e,e=>n({page:"files",fileId:e}))},r=e=>{(0,_.vV)("explorer-drop-zone:file-upload",e),H.oR.error(s("files-extract-error","Error when processing file"))};for(let e=0;e<a.length;e++){let t=a[e].webkitGetAsEntry();t&&function e(t,s,a){t.isFile?t.file(s,a):t.isDirectory&&t.createReader().readEntries(t=>{for(let l of t)e(l,s,a)},a)}(t,l,r)}},[s,i,n]),o=(0,W.t)({ref:l,onDrop:r});return(0,a.jsx)(W.u,{ref:l,dragState:o,title:s("explorer-dropzone.title","Drop files to upload"),className:t})}var $=s(77334),K=s(42557),G=s(41284),q=s(43086),Q=s(76545),X=s(94870),Y=s(24405),Z=s(75928),J=s(10636);let ee=(0,E.A)("BookOpenText",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M16 12h2",key:"7q9ll5"}],["path",{d:"M16 8h2",key:"msurwy"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}],["path",{d:"M6 12h2",key:"32wvfc"}],["path",{d:"M6 8h2",key:"30oboj"}]]),et=(0,E.A)("ArrowLeftToLine",[["path",{d:"M3 19V5",key:"rwsyhb"}],["path",{d:"m13 6-6 6 6 6",key:"1yhaz7"}],["path",{d:"M7 12h14",key:"uoisry"}]]);var es=s(44511);let ea=(0,E.A)("ArrowDownNarrowWide",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M11 4h4",key:"6d7r33"}],["path",{d:"M11 8h7",key:"djye34"}],["path",{d:"M11 12h10",key:"1438ji"}]]);var el=s(86565),ei=s(19717),en=s(697),er=s(36512);let eo=(0,E.A)("FolderUp",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}],["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"m9 13 3-3 3 3",key:"1pxg3c"}]]),ed=(0,p.memo)(e=>{let{children:t}=e,{t:s}=(0,g.Bd)("files"),l=(0,d.R)(e=>e.createAsset),i=(0,c.useStatsigClient)(),{push:n}=(0,C.wK)(),o=(0,el.KR)(),{ENABLE_IMAGE_EDITOR_IN_FILES:u,ENABLE_XLSX_EDITING:m}=(0,L.h)(),f=(0,p.useRef)(null),x=(0,d.R)(e=>e.uploadAsset),h=(0,p.useCallback)(e=>n({page:"files",fileId:e}),[n]),v=(0,p.useCallback)(e=>{l(e,h),i.logEvent("files.create-file",e)},[l,h,i]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(w.rI,{children:[(0,a.jsx)(w.ty,{asChild:!0,children:t||(0,a.jsxs)(r.$n,{variant:"filledSecondary",size:"iconSm",rounded:!0,children:[(0,a.jsx)(ei.A,{size:"16"}),(0,a.jsx)("span",{className:"sr-only",children:s("files-add-button.label","Add new file")})]})}),(0,a.jsxs)(w.SQ,{children:[(0,a.jsx)(ec,{fileTypeId:"markdown",onSelect:v}),u&&(0,a.jsxs)(w._2,{onSelect:()=>n({page:"files",fileId:null,emptyView:"image"}),children:[(0,a.jsx)(en.A,{size:16,className:"me-2"}),s("files-add-image","Image")]}),m&&(0,a.jsxs)(w._2,{onSelect:()=>{v(o.spreadsheet.newFileName)},children:[(0,p.createElement)(o.spreadsheet.Icon,{className:"me-2",size:16}),o.spreadsheet.name]}),(0,a.jsxs)(w.lv,{children:[(0,a.jsxs)(w.nV,{children:[(0,a.jsx)(er.A,{size:16,className:"me-2"}),s("files-add-code","Code")]}),(0,a.jsx)(w.dc,{children:(0,a.jsx)(w.M5,{children:el.cC.map(e=>(0,a.jsx)(ec,{fileTypeId:e,disableIcons:!0,onSelect:v},e))})})]}),(0,a.jsx)(w.mB,{className:"bg-border"}),(0,a.jsxs)(w._2,{onSelect:()=>{f.current&&f.current.click()},children:[(0,a.jsx)(eo,{size:16,className:"me-2"}),s("files-menu-upload.label","Upload Files")]})]})]}),(0,a.jsx)("input",{type:"file",ref:f,className:"hidden",onChange:e=>{e.target.files&&(Array.from(e.target.files).forEach(e=>{x(e,h)}),e.target.value="")},multiple:!0})]})});function ec(e){let{fileTypeId:t,onSelect:s,disableIcons:l}=e,{Icon:i,name:n,newFileName:r}=(0,el.KR)()[t];return(0,a.jsxs)(w._2,{onSelect:()=>s(r),children:[l?null:(0,a.jsx)(i,{size:16,className:"me-2"}),n]})}var eu=s(97377);function em(e){let{className:t,onClose:s,onBlur:l,...i}=e,{t:n}=(0,g.Bd)("files"),r=(0,o.cn)("rounded-full shadow-none border border-border ps-9 h-8 focus:ring-0",t),d=(0,p.useCallback)(e=>{null==l||l(e),""===e.target.value&&(null==s||s())},[l,s]);return(0,a.jsxs)("div",{className:"relative flex flex-1",children:[(0,a.jsx)(eu.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:16}),(0,a.jsx)(k.p,{placeholder:n("files-search-input.placeholder","Search"),className:r,onBlur:d,...i})]})}function ef(){var e,t;let{t:s}=(0,g.Bd)("files"),l=(0,C.wK)(),{push:i,replace:n}=l,c="files"===l.route.page?l.route:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";throw Error(e)}("Only use Header in /files"),u=(0,K.wV)(),[m,x]=(0,p.useState)(null!=(e=c.search)?e:""),[h,v]=(0,p.useState)(null!=(t=c.search)&&t),[j,b]=(0,p.useState)(!1),y=(0,N.o)(m,500);(0,p.useEffect)(()=>{n({page:"files",search:y})},[y,n]),(0,p.useEffect)(()=>{c.search||(b(!1),x(""))},[c.search]);let I=e=>{e.stopPropagation(),e.preventDefault(),b(!1),x(""),i({page:"files",sort:null,createdBy:null,fileType:null,search:""})},k="files"===c.page&&c.sort||null,S=e=>{i({page:"files",sort:e})},A="files"===c.page&&c.createdBy||null,E=e=>{i({page:"files",createdBy:e})},z="files"===c.page&&c.fileType||null,R=e=>{i({page:"files",fileType:e})},M=()=>{x(""),v(!1)},T=(0,p.useMemo)(()=>[{label:(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(G.e,{className:"w-6 h-6",textClassName:"!text-[10px]",user:u.user}),(0,a.jsx)(g.x6,{ns:"base",i18nKey:"file-browser.sort.creator-human",defaults:"Me"})]}),value:"user"},{label:(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(Q.Qtr,{size:"x-small",className:"w-6 h-6"}),(0,a.jsx)(g.x6,{ns:"base",i18nKey:"file-browser.sort.creator-grok",defaults:"Grok"})]}),value:"grok"}],[u.user]),D=[{value:"image",label:s("files-filter-images","Images"),icon:X.A},{value:"document",label:s("files-filter-documents","Documents"),icon:Y.A},{value:"spreadsheet",label:s("files-filter-spreadsheets","Spreadsheets"),icon:Z.A},{value:"code",label:s("files-filter-code","Code"),icon:J.A},{value:"pdf",label:s("files-filter-pdf","PDF"),icon:ee}];return(0,a.jsxs)("header",{className:"flex flex-col gap-4 pb-1",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("div",{className:"flex-1 relative",children:(0,a.jsx)(P.N,{mode:"sync",children:h?(0,a.jsx)(f.P.div,{initial:{width:"32px",height:"32px",opacity:0},animate:{width:"100%",height:"auto",opacity:1},exit:{width:"32px",height:"32px",opacity:0},transition:{duration:.3,ease:"easeOut"},className:"flex justify-end items-center gap-2 absolute top-0 end-0",children:(0,a.jsx)(em,{value:m,onChange:e=>{x(e.target.value)},autoFocus:!0,className:"flex-1",onKeyDown:e=>{"Escape"===e.key&&M()},onClose:M})},"search-input"):(0,a.jsxs)(f.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},className:"flex justify-between",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:(0,a.jsx)(C.N_,{route:{page:"files",fileId:null},children:s("files-explorer-header","Files")})}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(r.$n,{variant:"ghost",size:"iconSm",rounded:!0,"aria-label":s("files-explorer-collapse-button","Collapse"),onClick:()=>d.R.getState().setIsFileExplorerCollapsed(!0),children:(0,a.jsx)(et,{size:15,className:"text-fg-secondary"})}),(0,a.jsxs)(r.$n,{variant:"ghost",size:"iconSm",rounded:!0,onClick:()=>v(!0),children:[(0,a.jsx)($.WI,{size:15,className:"text-fg-secondary"}),(0,a.jsx)("span",{className:"sr-only",children:s("files-search-open-button.label","Show search input")})]})]})]},"title-and-button")})}),(0,a.jsx)(ed,{})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(w.rI,{open:j,onOpenChange:b,children:[(0,a.jsxs)("div",{className:(0,o.cn)("flex items-center rounded-full border gap-0.5 border-border-l2 h-8 overflow-hidden",z?"bg-button-ghost-hover border-secondary pr-0":void 0),children:[(0,a.jsx)(w.ty,{asChild:!0,children:(0,a.jsxs)(r.$n,{variant:"ghost",size:"sm",className:(0,o.cn)("border-0",z?"pr-0 hover:bg-transparent":void 0),style:{boxShadow:"none"},children:[(0,a.jsx)(es.A,{size:15,className:"text-fg-secondary"}),(0,a.jsx)("span",{className:"sr-only",children:s("files-filter-open-button.label","Show filters")}),s("files-fiolter-show-menu","Filter")]})}),z?(0,a.jsxs)(r.$n,{variant:"ghost",size:"iconSm",onClick:I,rounded:!0,children:[(0,a.jsx)($.uv,{size:16}),(0,a.jsx)("span",{className:"sr-only",children:s("files-filter-clear","Clear all filters")})]}):null]}),(0,a.jsxs)(w.SQ,{side:"bottom",align:"start",sideOffset:6,className:"no-a11y-check rounded-2xl",children:[(0,a.jsxs)("div",{className:"min-w-36 flex gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-secondary ms-3 my-2",children:s("files-filter-by-type","File Type")}),D.map(e=>{let t=e.icon;return(0,a.jsxs)(w._2,{onSelect:()=>R(e.value),className:"flex items-center gap-2",children:[(0,a.jsx)(t,{size:16,className:"text-fg-secondary"}),e.label,z===e.value&&(0,a.jsx)("span",{className:"ms-auto text-xs text-primary",children:"✓"})]},e.value||"all")})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-secondary ms-3 my-2 min-w-32",children:s("files-filter-by-creator","Created By")}),T.map(e=>(0,a.jsxs)(w._2,{onSelect:()=>E(e.value),className:"flex items-center gap-2",children:[e.label,A===e.value&&(0,a.jsx)("span",{className:"ms-auto text-xs text-primary",children:"✓"})]},"CREATOR_OPTIONS"+e.value.toString()))]})]}),(m||z||A)&&(0,a.jsx)(r.$n,{variant:"outline",onClick:I,className:"w-full mt-4 rounded-xl",children:s("files-filter-reset","Reset filters")})]})]}),(0,a.jsxs)(w.rI,{children:[(0,a.jsx)(w.ty,{asChild:!0,children:(0,a.jsxs)(r.$n,{variant:"outline",size:"sm",rounded:!0,children:[(0,a.jsx)(ea,{size:15,className:"text-fg-secondary"}),(0,a.jsx)("span",{className:"sr-only",children:s("files-sort-show-menu","Show sorting menu")}),s("files-sort-show-menu","Sort")]})}),(0,a.jsx)(w.SQ,{side:"bottom",align:"start",sideOffset:6,className:"min-w-36",children:O.map(e=>(0,a.jsxs)(w._2,{onSelect:()=>S(e.value),className:"flex items-center gap-2",children:[e.label,k===e.value&&(0,a.jsx)("span",{className:"ms-auto text-xs text-primary",children:"✓"})]},e.value))})]}),(0,a.jsx)(ex,{})]})]})}let ex=(0,p.memo)(function(){let e=(0,d.R)(e=>"loading"===e.listStatus);return(0,a.jsx)(P.N,{children:e&&(0,a.jsx)(f.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,ease:"easeOut"},className:"flex-1 flex justify-end items-center",children:(0,a.jsx)(q.y,{size:"xs",className:"border-b-secondary"})})})});var ep=s(83638),eg=s(51182),eh=s(49881);function ev(e){let{onRetry:t}=e,{t:s}=(0,g.Bd)("files");return(0,a.jsxs)("div",{className:"border border-l1 bg-surface-l1 rounded-2xl p-4 flex flex-col items-center justify-center text-center",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold mb-2",children:s("files-list-loading-error.title","Could not load files")}),(0,a.jsx)("p",{className:"text-xs text-fg-secondary mb-4",children:s("files-list-loading-error.message","Something went wrong when loading your files")}),(0,a.jsxs)(r.$n,{variant:"outline",size:"md",onClick:t,children:[(0,a.jsx)(eh.A,{className:"me-2 h-4 w-4"}),s("files-list-loading-error.retry","Retry")]})]})}var ej=s(6085);function eb(e){let{onFiltersClear:t}=e,{t:s}=(0,g.Bd)("files");return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full gap-4",children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:s("files-no-results.label","No results")}),(0,a.jsxs)(r.$n,{variant:"outline",size:"sm",onClick:()=>{null==t||t()},children:[(0,a.jsx)(ej.A,{className:"size-4 me-2"}),(0,a.jsx)("span",{children:s("files-clear-filters.label","Clear filters")})]})]})}var ey=s(66347),eI=s(35795),ew=s(93038);function ek(e){var t;let{asset:s,stack:n,className:r}=e;return(0,a.jsx)("div",{className:(0,o.cn)("relative",r),children:(0,a.jsxs)(P.N,{initial:!1,children:[(0,a.jsx)(f.P.div,{animate:{rotate:-6},transition:{delay:.2,duration:.4},children:(0,a.jsx)(l.E,{metadata:(0,i.B)(s),className:"rounded-md w-6 h-6 ms-0 me-0 [&>img]:h-full [&>img]:w-full bg-transparent"})},s.assetId),(0,a.jsx)(f.P.div,{animate:{rotate:30},transition:{duration:.5},className:"absolute inset-0 -z-10 opacity-40 dark:opacity-60",children:(0,a.jsx)(l.E,{metadata:(0,i.B)(n[0]),className:"rounded-md w-6 h-6 ms-0 me-0 [&>img]:h-full [&>img]:w-full bg-transparent scale-105"})},null==(t=n[0])?void 0:t.assetId)]})})}var eN=s(82263);function eC(e){let{okLabel:t,onOk:s,cancelLabel:l,onCancel:i}=e;return(0,a.jsxs)("div",{className:(0,o.cn)("flex","items-center justify-end gap-0.5"),children:[(0,a.jsxs)(r.gx,{variant:"ghost",size:"iconSm",rounded:!0,onClick:i,tooltipContent:l,tooltipContentProps:{hideWhenDetached:!0},children:[(0,a.jsx)($.uv,{size:16,className:"text-fg-primary"}),(0,a.jsx)("span",{className:"sr-only",children:l})]}),(0,a.jsxs)(r.gx,{variant:"ghost",size:"iconSm",rounded:!0,onClick:s,tooltipContent:t,tooltipContentProps:{hideWhenDetached:!0},children:[(0,a.jsx)(eN.A,{size:16,className:"text-fg-primary"}),(0,a.jsx)("span",{className:"sr-only",children:l})]})]})}var eS=s(2280),eA=s(80354);let eE=(0,p.memo)(function(e){let{value:t,onSubmit:s,onCancel:l,state:i,suffix:n,className:r}=e,{t:d}=(0,g.Bd)("files"),[c,u]=(0,p.useState)(t),m=(0,p.useRef)(null);(0,p.useEffect)(()=>{u(t)},[t]),(0,p.useEffect)(()=>{"edit"===i&&m.current&&(m.current.focus(),m.current.setSelectionRange(0,m.current.value.lastIndexOf(".")))},[i]);let f=()=>{s(c.trim())},x=e=>{e.preventDefault(),e.stopPropagation(),f()};if("edit"===i)return(0,a.jsxs)("div",{className:"flex flex-1",onClick:eA.Y,children:[(0,a.jsx)("input",{ref:m,className:"w-full bg-transparent focus-visible:outline-none",value:c,onKeyDown:e=>{"Enter"===e.key?f():"Escape"===e.key&&l()},onChange:e=>u(e.target.value),"aria-label":d("filename-edit-input.label","Edit file name")}),(0,a.jsx)(eC,{onCancel:e=>{e.preventDefault(),e.stopPropagation(),l()},cancelLabel:d("Cancel","Cancel"),onOk:e=>{e.preventDefault(),e.stopPropagation(),x(e)},okLabel:d("Save","Save")})]});let h=(0,o.cn)("flex-1 select-none text-nowrap max-w-full overflow-hidden inline-block",r);return(0,a.jsxs)("span",{className:h,style:{maskImage:eS.zU,WebkitMaskImage:eS.zU},children:[t,n&&(0,a.jsx)("span",{className:"text-fg-tertiary",children:n})]})}),ez=e=>(0,a.jsx)("span",{className:"font-bold",children:e}),eR=e=>{let{text:t,pattern:s,renderMatch:l=ez}=e,i=(0,p.useMemo)(()=>{let e=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),a=RegExp("(".concat(e,")"),"gi");return t.split(a)},[t,s]);return(0,a.jsx)(a.Fragment,{children:i.map((e,t)=>e.toLowerCase()===s.toLowerCase()&&l?(0,a.jsx)(p.Fragment,{children:l(e)},t):(0,a.jsx)(p.Fragment,{children:e},t))})};function eM(e){let{assetId:t}=e,s=(0,d.R)(e=>e.debouncedSearchQuery),l=(0,d.R)(e=>{var a,l;return null!=(l=null==(a=e.searchHighlight[s])?void 0:a[t])?l:""});return(0,L.h)().ENABLE_FILES_ES_SEARCH&&l&&s?(0,a.jsx)("div",{className:"px-3 mb-2 text-xs text-fg-secondary text-start max-w-full text-wrap line-clamp-3 leading-normal max-h-[4.5em]",children:(0,a.jsx)(eR,{text:l,pattern:s,renderMatch:eP})}):null}let eP=e=>(0,a.jsx)("span",{className:"text-fg-primary font-semibold",children:e});function eT(e){let t=e.lastIndexOf(".");return -1===t?[e,""]:[e.slice(0,t),e.slice(t+1)]}let eD=(0,p.memo)(function(e){var t,s,n,u,f,x,h;let{asset:v,stackedAssets:j,action:b,onActionChange:y,className:I,isActive:k=!1}=e,{push:N,route:S}=(0,C.wK)(),{t:A}=(0,g.Bd)("base"),E=(0,d.R)((0,eg.k)(e=>e.assetsById)),z=(0,c.useStatsigClient)(),[,R]=eT(null!=(s=v.name)?s:""),M=null!=(u=null!=R?R:(0,ew.extension)(null!=(n=v.mimeType)?n:""))?u:"",P=(null==b?void 0:b.type)==="edit"&&(null==b?void 0:b.assetId)===v.assetId,T=(null==b?void 0:b.type)==="delete"&&(null==b?void 0:b.assetId)===v.assetId,D=(0,d.R)(e=>e.renameAsset),B=(0,p.useMemo)(()=>j.map(e=>{var t;return null==(t=E[e])?void 0:t.data}).filter(Boolean).sort((e,t)=>new Date((null==e?void 0:e.createTime)||"").getTime()-new Date((null==t?void 0:t.createTime)||"").getTime())||[],[j,E]),O=(0,p.useCallback)(()=>{y(null)},[y]),U=(0,p.useCallback)(e=>{var t,s,a,l;let i=null==(s=E[v.rootAssetId||v.assetId])||null==(t=s.data)?void 0:t.sourceConversationId,n=null!=(l=null!=(a=v.rootAssetSourceConversationId)?a:i)?l:v.sourceConversationId;n&&(e.stopPropagation(),e.preventDefault(),N({page:"chat",conversationId:n,temporary:!1}))},[v.rootAssetSourceConversationId,v.rootAssetId,v.assetId,v.sourceConversationId,E,N]),F=(0,p.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),y({type:"delete",assetId:v.assetId})},[v.assetId,y]),L=(0,p.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),O()},[O]),W=(0,d.R)(e=>e.deleteAsset),H=(0,o.cn)("flex py-0 gap-1 relat justify-start items-center w-full overflow-hidden group/file hover:bg-button-ghost-hover min-h-10 h-auto items-stretch",{"bg-button-ghost-active":k},I);return(0,a.jsx)(r.$n,{variant:"ghost",className:H,asChild:!0,children:(0,a.jsxs)(C.N_,{route:{page:"files",fileId:null!=(x=null!=(f=v.rootAssetId)?f:v.assetId)?x:null},className:(0,o.cn)("group/file text-sm","w-full flex flex-col justify-center !gap-0 text-primary ps-0 pe-1"),children:[(0,a.jsxs)("div",{className:"w-full flex flex-row gap-2 text-primary ps-2 items-center min-h-10",children:[(null==(t=v.mimeType)?void 0:t.startsWith("image/"))&&B.length>0?(0,a.jsx)(ek,{asset:v,stack:B,className:"w-fit h-fit"}):(0,a.jsx)(l.E,{metadata:(0,i.B)(v),className:"rounded-md w-6 h-6 ms-0 me-0 [&>img]:h-full [&>img]:w-full bg-transparent"}),(0,a.jsx)(eE,{value:null!=(h=v.name)?h:"",onCancel:O,onSubmit:e=>{var t;y(null),""!==e&&(D(null!=(t=v.assetId)?t:"",e).catch((0,_.HX)("FileRow")),z.logEvent("files.rename",e))},state:P?"edit":"view"}),P?null:T?(0,a.jsx)(eC,{onCancel:L,cancelLabel:A("Cancel","Cancel"),onOk:e=>{var t;e.stopPropagation(),e.preventDefault(),y(null),W(null!=(t=v.assetId)?t:""),z.logEvent("files.delete",v.assetId),"files"===S.page&&(S.fileId===v.rootAssetId||S.fileId===v.assetId)&&N({page:"files",fileId:null})},okLabel:A("Delete","Delete")}):(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:(0,o.cn)("hidden group-hover/file:hidden group-focus-visible/file:hidden","text-fg-secondary"),children:M}),(0,a.jsxs)("div",{className:(0,o.cn)("flex items-center justify-end"),children:[(0,a.jsxs)(w.rI,{children:[(0,a.jsx)(w.ty,{asChild:!0,children:(0,a.jsxs)(r.gx,{tabIndex:-1,className:(0,o.cn)("text-fg-secondary",v.isRootAssetCreatedByModel?"w-8":"w-0","group-hover/file:w-8 group-focus-visible/file:w-8 group-hover/file:flex group-focus-visible/file:flex"),variant:"ghost",size:"iconSm",rounded:!0,style:{boxShadow:v.isRootAssetCreatedByModel?"none":void 0},tooltipContent:A("files-more-options.label","Options"),tooltipContentProps:{hideWhenDetached:!0,side:"bottom"},children:[v.isRootAssetCreatedByModel?(0,a.jsx)(Q.Qtr,{size:16,className:(0,o.cn)("opacity-20 group-hover/file:hidden group-focus-visible/file:hidden")}):null,(0,a.jsx)(ey.A,{size:16,className:"hidden group-hover/file:block group-focus-visible/file:block"}),(0,a.jsx)("span",{className:"sr-only",children:A("files-more-options.label","Options")})]})}),(0,a.jsxs)(w.SQ,{side:"bottom",align:"end",className:"min-w-36",children:[(0,a.jsxs)(w._2,{onSelect:e=>{e.preventDefault(),y({type:"edit",assetId:v.assetId})},className:"flex items-center gap-2",children:[(0,a.jsx)($.rZ,{size:16,className:"text-fg-secondary"}),A("files-edit.label","Edit")]}),v.isRootAssetCreatedByModel&&(0,a.jsxs)(w._2,{onClick:e=>{U(e)},className:"flex items-center gap-2",children:[(0,a.jsx)(eI.A,{size:16,className:"text-fg-secondary"}),A("files-open-conversation.label","Open Conversation")]})]})]}),(0,a.jsxs)(r.gx,{tabIndex:-1,className:(0,o.cn)("text-fg-secondary","hidden group-hover/file:flex group-focus-visible/file:flex"),onClick:F,variant:"ghost",size:"iconSm",rounded:!0,tooltipContent:A("files-list-delete.tooltip","Delete file"),tooltipContentProps:{hideWhenDetached:!0},children:[(0,a.jsx)(m.A,{size:16}),(0,a.jsx)("span",{className:"sr-only",children:A("files-list-delete","Delete file")})]})]})]})]}),(0,a.jsx)(eM,{assetId:v.assetId})]})})});var e_=s(69358),eB=s(80226);function eO(){return(0,a.jsx)(e_.P,{delayMs:300,children:(0,a.jsxs)("div",{className:"flex flex-col gap-4 p-3","aria-busy":"true",children:[(0,a.jsx)(eU,{className:"w-1/5"}),(0,a.jsx)(eU,{className:"w-3/5"}),(0,a.jsx)(eU,{className:"w-2/5"}),(0,a.jsx)(eU,{className:"w-1/5"}),(0,a.jsx)(eU,{className:"w-2/3"})]})})}let eU=e=>{let{className:t}=e;return(0,a.jsxs)("div",{className:"flex w-full gap-3 items-center",children:[(0,a.jsx)(eB.E,{className:"w-6 h-6 rounded-md"}),(0,a.jsx)(eB.E,{className:(0,o.cn)("w-full rounded-xl h-4",t)})]})};function eF(){let{t:e}=(0,g.Bd)("files");return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full gap-4 text-muted-foreground",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-center",children:e("files-empty.title","No files yet")}),(0,a.jsx)("p",{className:"text-center",children:e("files-empty.subtitle","Upload files or ask Grok to create one")}),(0,a.jsx)(ed,{children:(0,a.jsxs)(r.$n,{variant:"outline",size:"sm",children:[(0,a.jsx)(ei.A,{className:"size-4"}),e("files-empty.add-button","Add File")]})})]})}let eL=(0,p.memo)(e=>{let{className:t}=e,{t:s}=(0,g.Bd)("files"),l=(0,C.wK)(),i=l.push,n="files"===l.route.page?l.route:S("Files list only for /files"),[r,u]=(0,p.useState)(null),m=(0,d.R)(e=>e.loadFirstPage),x=(0,d.R)(e=>e.loadNextPage),h=(0,d.R)(e=>e.listPageToken),v=(0,c.useStatsigClient)();(0,p.useEffect)(()=>{m({search:n.search,sort:n.sort,fileType:n.fileType,createdBy:n.createdBy}),n.search&&v.logEvent("files.search"),n.sort&&"used"!==n.sort&&v.logEvent("files.sort",n.sort),(n.fileType||n.createdBy)&&v.logEvent("files.filter")},[m,n,v]);let j=(0,d.R)(e=>!!(e.debouncedSearchQuery||e.searchFileType||e.source)),b=(0,d.R)((0,eg.k)(e=>e.list)),I=(0,d.R)((0,eg.k)(e=>e.listStatus)),w=(0,d.R)((0,eg.k)(e=>e.assetsById)),k=(0,d.R)((0,eg.k)(e=>e.currentVersion)),N=(0,p.useMemo)(()=>b.map(e=>{var t;return null==(t=w[e])?void 0:t.data}).filter(A),[b,w]),E=(0,p.useMemo)(()=>{let e=N.reduce((e,t)=>{var s;return(null==(s=t.mimeType)?void 0:s.startsWith("image/"))&&t.sourceConversationId&&(e[t.sourceConversationId]||(e[t.sourceConversationId]=[]),e[t.sourceConversationId].push(t.assetId)),e},{});return N.map(t=>{var s;let a=[];if((null==(s=t.mimeType)?void 0:s.startsWith("image/"))&&t.currentConversationId){let s=e[t.currentConversationId];s&&a.push(...s)}return{rootAsset:t,children:a}})},[N]),z=(0,p.useMemo)(()=>{let e=new Set(E.flatMap(e=>e.children.filter(t=>t!==e.rootAsset.assetId)));return b.filter(t=>!e.has(t))},[b,E]),R=(0,d.R)(e=>e.creationRequests),M=(0,p.useCallback)(()=>{h&&"loading"!==I&&x()},[I,x,h]),T=(0,ep.B)(M),D=null;if("loading"===I&&!h&&0===b.length)return(0,a.jsx)(eO,{});"ready"===I?0===b.length?D=j?(0,a.jsx)(eb,{onFiltersClear:()=>{i({...n,sort:void 0,createdBy:void 0,fileType:void 0,search:""})}}):(0,a.jsx)(eF,{}):h&&(D=(0,a.jsx)("div",{ref:T,className:"text-center mt-8 text-sm text-fg-secondary",children:s("files-scrollto.label","Scroll to load more")})):"loading"===I?h&&(D=(0,a.jsx)(eO,{})):"error"===I&&(D=(0,a.jsx)(ev,{onRetry:m}));let _=(0,o.cn)("gap-0",t);return(0,a.jsxs)(y.D,{className:_,fadeSize:"md","aria-busy":"loading"===I,children:[(0,a.jsx)("ol",{children:R.filter(e=>!e.assetId||!w[e.assetId]).map(e=>(0,a.jsx)(f.P.li,{initial:{height:0,scaleY:0,opacity:0},animate:{height:"auto",scaleY:1,opacity:1},transition:{duration:.15},children:(0,a.jsx)(eW,{request:e})},e.name))}),(0,a.jsx)("ol",{children:(0,a.jsx)(P.N,{children:z.map(e=>{var t,s;let l=null==(t=w[k[e]])?void 0:t.data;return l?(0,a.jsx)(f.P.li,{initial:{height:"auto",scaleY:1,opacity:1},exit:{height:0,scaleY:0,opacity:0},transition:{duration:.15},children:(0,a.jsx)(eD,{asset:l,stackedAssets:(null==(s=E.find(t=>t.rootAsset.assetId===e))?void 0:s.children)||[],action:r,onActionChange:u,isActive:n.fileId===e||R.some(t=>t.assetId===e)})},e):null})})}),D]})});function eW(e){var t;let{request:s}=e,[l,i]=eT(null!=(t=s.name)?t:"");return(0,a.jsxs)("div",{className:"h-[42px] rounded-xl px-3.5 text-sm p-4 flex items-center bg-button-ghost-active",children:[(0,a.jsx)(q.y,{size:"xs",className:"me-[11px]"}),(0,a.jsx)("span",{children:l}),i&&(0,a.jsxs)("span",{className:"text-fg-secondary",children:[".",i]})]})}function eH(e){let{className:t}=e,{ENABLE_FILES_ES_SEARCH:s}=(0,L.h)();return(0,p.useEffect)(()=>{d.R.setState({useNewSearch:s})},[s]),(0,a.jsxs)("div",{className:(0,o.cn)("flex flex-col",t),children:[(0,a.jsx)("div",{className:"px-4 pt-4",children:(0,a.jsx)(ef,{})}),(0,a.jsxs)("div",{className:"flex-1 overflow-hidden relative",children:[(0,a.jsx)(eL,{className:"h-full px-2"}),(0,a.jsx)(V,{className:"m-2"})]})]})}var eV=s(5663),e$=s(46748),eK=s(33231),eG=s(41320),eq=s(91631),eQ=s(10953),eX=s(5828);function eY(e){let{className:t,buttonText:s,multiple:l=!0}=e,{t:i}=(0,g.Bd)("files"),n=(0,p.useRef)(null),c=(0,o.cn)("flex flex-col items-start justify-between h-auto p-3 rounded-xl min-w-[120px] bg-surface-l1",t),u=(0,d.R)(e=>e.uploadAsset),{push:m}=(0,C.wK)(),f=(0,p.useCallback)(e=>m({page:"files",fileId:e}),[m]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.$n,{variant:"outline",className:c,onClick:()=>{n.current&&n.current.click()},disabled:!1,children:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eo,{className:"w-6 h-6 mb-1 text-secondary"}),(0,a.jsx)("span",{children:s||i("file-upload-button.label","Upload Files")})]})}),(0,a.jsx)("input",{type:"file",ref:n,style:{display:"none"},onChange:e=>{e.target.files&&(Array.from(e.target.files).forEach(e=>{u(e,f)}),e.target.value="")},multiple:l})]})}let eZ="w-6 h-6 mb-1 text-secondary",eJ=(0,p.memo)(e=>{let{className:t}=e,{ENABLE_IMAGE_EDITOR_IN_FILES:s,ENABLE_XLSX_EDITING:l}=(0,L.h)(),{t:i}=(0,g.Bd)("files"),{push:n}=(0,C.wK)(),r=(0,el.KR)(),u=(0,c.useStatsigClient)(),m=(0,d.R)(e=>e.createAsset),x=(0,p.useCallback)((e,t)=>{m(e,t),u.logEvent("files.create-file",e)},[m,u]),h=e=>n({page:"files",fileId:e});return(0,a.jsxs)("div",{className:"h-full relative",children:[(0,a.jsx)(eX.e,{className:"absolute top-4 left-4"}),(0,a.jsxs)(f.P.div,{initial:{opacity:0},animate:{opacity:1},className:(0,o.cn)("flex flex-col items-center justify-center h-full p-4",t),children:[(0,a.jsx)(eQ.$r,{className:"w-20 h-20 text-muted-foreground"}),(0,a.jsx)("p",{className:"mt-4 text-md text-muted-foreground",children:i("empty.create-something-new","Create something new")}),(0,a.jsxs)("div",{className:"mt-6 grid grid-cols-2 md:grid-cols-3 gap-3 overflow-wrap justify-items-center lg:flex lg:flex-nowrap lg:justify-center",children:[(0,a.jsx)(e0,{icon:(0,a.jsx)(Y.A,{className:eZ}),text:i("empty.document","Document"),onClick:()=>void x(r.markdown.newFileName,h)}),l&&(0,a.jsx)(e0,{icon:(0,p.createElement)(r.spreadsheet.Icon,{className:eZ}),text:i("empty.spreadsheet","Spreadsheet"),onClick:()=>void x(r.spreadsheet.newFileName,h)}),(0,a.jsxs)(w.rI,{children:[(0,a.jsx)(w.ty,{asChild:!0,children:(0,a.jsx)(e0,{icon:(0,a.jsx)(er.A,{className:eZ}),text:i("empty.code","Code")})}),(0,a.jsx)(w.SQ,{side:"right",children:el.cC.map(e=>(0,a.jsx)(e1,{fileTypeId:e,disableIcons:!0,onSelect:e=>void x(e,h)},e))})]}),s&&(0,a.jsx)(e0,{icon:(0,a.jsx)(en.A,{className:eZ}),text:i("empty.image","Image"),onClick:()=>{n({page:"files",fileId:null,emptyView:"image"})}}),(0,a.jsx)(eY,{})]}),(0,a.jsx)(V,{className:"m-4"})]})]})});function e0(e){let{icon:t,text:s,...l}=e;return(0,a.jsxs)(r.$n,{variant:"outline",className:"flex flex-col items-start justify-start h-auto p-3 rounded-xl min-w-[120px] bg-surface-l1",...l,children:[t,(0,a.jsx)("span",{children:s})]})}function e1(e){let{fileTypeId:t,onSelect:s,disableIcons:l}=e,{Icon:i,name:n,newFileName:r}=(0,el.KR)()[t];return(0,a.jsxs)(w._2,{onSelect:()=>s(r),children:[l?null:(0,a.jsx)(i,{size:16,className:"me-2"}),n]})}var e2=s(4878),e3=s(43893),e4=s(44347),e5=s(39489),e6=s(82591),e8=s(23556),e7=s(28951);let e9=e=>{let{className:t}=e;return(0,a.jsx)(f.P.div,{initial:{opacity:0,filter:"blur(4px)"},animate:{opacity:1,filter:"blur(0px)"},transition:{ease:"easeInOut"},className:(0,o.cn)("h-full w-full flex items-center justify-center animate-pulse-lg",t),children:(0,a.jsx)(X.A,{size:60,strokeWidth:1.3,className:"opacity-30 rotate-[-10deg]"})},"loader")},te=e=>{let{selectedImage:t,isPeekingParent:s,isFinalImageLoaded:l,setIsFinalImageLoaded:i,isParentImageLoaded:n,setIsParentImageLoaded:r}=e,[d,c]=(0,p.useState)([]),[u,m]=(0,p.useState)(!0),x=(0,p.useMemo)(()=>"streaming"===t.state,[t.state]),g=(0,p.useMemo)(()=>!!(t.generatedImageHeight&&t.generatedImageWidth),[t.generatedImageHeight,t.generatedImageWidth]),h=(0,p.useMemo)(()=>t.generatedImageHeight&&t.generatedImageWidth?t.generatedImageWidth/t.generatedImageHeight:4/3,[t.generatedImageHeight,t.generatedImageWidth]);return(0,p.useEffect)(()=>{(x||!u)&&(null==t?void 0:t.progressMap)?c(t.progressMap):!x&&(null==t?void 0:t.url)?c(e=>[...e,{progress:1,imageUrl:t.url||""}]):c([])},[x,null==t?void 0:t.url,null==t?void 0:t.progressMap,u]),(0,p.useEffect)(()=>{x&&u&&m(!1),x||!l||u||m(!0)},[x,l,u]),(0,a.jsx)("figure",{className:(0,o.cn)("relative group/image w-full max-w-5xl 2xl:max-w-6xl overflow-hidden rounded-lg"),children:(0,a.jsx)(P.N,{mode:"wait",children:x||!u?g?(0,a.jsx)(f.P.div,{initial:{opacity:0,filter:"blur(4px)"},animate:{opacity:1,filter:"blur(0px)"},exit:{opacity:1,filter:"blur(0px)",transition:{delay:1.5}},transition:{ease:"easeInOut"},className:"h-full mx-auto",style:{aspectRatio:h,maxHeight:t.generatedImageHeight},children:(0,a.jsx)(e7.L,{status:"streaming",intermediateResults:d,isModerated:t.isModerated,aspectRatio:h})},"streaming-image"):(0,a.jsx)(e9,{}):(0,a.jsxs)("div",{className:"flex relative items-center justify-center w-full h-full",children:[t.url&&(0,a.jsxs)(a.Fragment,{children:[!l&&(0,a.jsx)(e9,{className:"absolute z-20 inset-0"}),(0,a.jsx)(f.P.img,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},exit:"hidden",animate:t&&s||!l?"hidden":"visible",transition:{ease:"easeInOut"},src:t.url,alt:"active-image",className:"max-h-full aspect-auto rounded-lg",onLoad:()=>i(!0)},"finished-image")]}),(0,a.jsx)(P.N,{children:!x&&t&&s&&(0,a.jsxs)(f.P.div,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},initial:"hidden",exit:"hidden",animate:"visible",transition:{ease:"easeInOut"},className:"absolute z-10 w-full h-full flex items-center overflow-hidden",children:[!n&&(0,a.jsx)(e9,{className:"absolute z-20 inset-0"}),(0,a.jsx)(f.P.img,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},animate:n?"visible":"hidden",src:t.parentImageUrl,alt:"parent-image",className:"max-h-full aspect-auto mx-auto rounded-lg",onLoad:()=>r(!0)},"parent-image")]},"parent-image-container")})]})})})};var tt=s(24734),ts=s(70888),ta=s(13884),tl=s(95088),ti=s(82123),tn=s(59996);let tr=e=>{let{children:t,onUploadImage:s}=e,{t:l}=(0,g.Bd)("base"),i=(0,ts.x)(x.A("fetchUploadFile")),n=(0,ts.x)(x.A("removeByConversationId")),o=(0,h.aP)(x.A("conversationId")),d=(0,tt.K)(),c=(0,p.useRef)(null),[u,m]=(0,p.useState)(!1),[v,j]=(0,p.useState)(!1),[b,y]=(0,p.useState)(!1),I=(0,p.useCallback)(()=>{var e;null==(e=c.current)||e.click()},[]),w=(0,p.useCallback)(async e=>{let t;if(1!==e.length)return void H.oR.error(l("image-editor.one-upload-allowed","Only a single image file is allowed"));if(!["image/png","image/jpeg","image/jpg","image/webp"].includes(e[0].type))return void H.oR.error(l("image-editor.images-only-allowed","Only image files are allowed"));j(!0);try{let s=i(e[0],o||"no_conversation_id");t=await s.metadataPromise}catch(e){d("image-editor-upload:uploadFile",e)}t instanceof Error&&d("image-editor-upload:uploadFile",t,l("image-editor.failed-to-upload","Failed to upload file")),j(!1),n(o||"no_conversation_id"),!t||t instanceof Error||s(t)},[l,i,o,s,n,d]),k=(0,p.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),v||m(!0)},[v]),N=(0,p.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),m(!1)},[]),C=(0,p.useCallback)(e=>{if(e.preventDefault(),e.stopPropagation(),m(!1),!v)return w(Array.from(e.dataTransfer.files))},[w,v]),S=(0,p.useCallback)(e=>{if(e.target.files)return w(Array.from(e.target.files)).finally(()=>{c.current&&(c.current.value="")})},[w]),A=(0,p.useCallback)(async e=>w([e]).finally(()=>{y(!1)}),[w]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f.P.div,{initial:{opacity:0},animate:{opacity:1},onDragOver:k,onDragLeave:N,onDrop:C,className:"border resize transition-colors w-full h-full flex justify-center items-center border-border-l1 rounded-2xl p-8 mb-3 text-center ".concat(u&&!v&&"bg-surface-l1 border-border-l1"),children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4 w-full",children:[(0,a.jsx)("div",{className:"p-4 rounded-full text-fg-secondary transition-colors bg-surface-l1",children:(0,a.jsx)(P.N,{mode:"popLayout",children:u&&!v?(0,a.jsx)(f.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,a.jsx)(ta.A,{className:"size-6"})},"files"):(0,a.jsx)(f.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,a.jsx)(en.A,{className:"size-6"})},"image-plus")})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-primary",children:l("image-editor.empty.title","Ask Grok to create an image")}),(0,a.jsx)(P.N,{mode:"popLayout",children:v?(0,a.jsx)(f.P.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary whitespace-nowrap",children:l("image-editor.empty.uploading-image","Uploading image")},"uploading"):u?(0,a.jsx)(f.P.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary whitespace-nowrap",children:l("image-editor.empty.drop-image","Drop image here")},"dragging"):(0,a.jsx)(f.P.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary whitespace-nowrap",children:l("image-editor.empty.description","You can also upload an image or draw instead.")},"not-dragging")})]}),t,(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)(r.$n,{variant:"outline",className:"text-fg-primary hover:bg-button-ghost-hover rounded-2xl transition-all py-2.5 px-4 h-auto *:hover:text-fg-primary *:hover:transition-colors",disabled:v,onClick:I,children:[v?(0,a.jsx)(q.y,{size:"xxs"}):(0,a.jsx)(tl.A,{className:"size-4 text-fg-secondary"}),l("image-editor.empty.upload","Upload")]}),(0,a.jsxs)(r.$n,{variant:"outline",className:"text-fg-primary hover:bg-button-ghost-hover rounded-2xl transition-all py-2.5 px-4 h-auto *:hover:text-fg-primary *:hover:transition-colors",disabled:v,onClick:()=>{y(!0)},children:[(0,a.jsx)(ti.A,{className:"size-4 text-fg-secondary"}),l("image-editor.empty.draw","Draw")]})]}),(0,a.jsx)("input",{ref:c,className:"hidden",type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp",onChange:S,multiple:!1,"data-testid":"file-input"})]})}),(0,a.jsx)(tn.A,{open:b,setOpen:y,onAttach:A})]})};var to=s(69007),td=s(12220);let tc=(0,E.A)("FileDown",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);var tu=s(47127);let tm=e=>{let{selectedImage:t,title:s,isSending:l=!1,onRegenerate:i,onClose:n}=e,{t:o}=(0,g.Bd)("base"),[d,c]=(0,p.useState)(!1),u=(0,h.aP)(e=>e.conversationId),m=(0,h.aP)(e=>e.lastMessageId),x=(0,p.useCallback)(()=>{var e;!d&&(null==t?void 0:t.url)&&(c(!0),(0,td.G)(t.url,null==(e=t.url)?void 0:e.split("/").pop()).catch((0,_.HX)("image-editor:handleDownload")).finally(()=>c(!1)))},[d,t]);return(0,a.jsx)("header",{className:"flex justify-between w-full items-start h-10 gap-3  relative z-30 flex-shrink-0",children:(0,a.jsxs)(P.N,{mode:"popLayout",children:[s&&(0,a.jsx)(f.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},className:"w-full overflow-hidden min-w-0 hidden sm:block",children:s},JSON.stringify(s)),(0,a.jsxs)("div",{className:"flex gap-2 ml-auto shrink-0",children:[(null==t?void 0:t.state)&&["streaming","error","completed"].includes(t.state)&&(null==t?void 0:t.regenResponseId)&&(0,a.jsx)(f.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,a.jsx)(r.gx,{size:"iconMd",variant:"ghost",rounded:!0,"aria-label":o("image-editor.regenerate","Regenerate Image"),tooltipContent:o("image-editor.regenerate","Regenerate Image"),tooltipContentProps:{side:"bottom"},asChild:!0,disabled:"streaming"===t.state||l,onClick:i,children:(0,a.jsx)(f.P.button,{whileTap:(null==t?void 0:t.state)==="streaming"||l?void 0:{scale:.9},children:(0,a.jsx)($.V$,{className:"size-5"})})})},"regenerate"),t&&(0,a.jsx)(f.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,a.jsx)(r.gx,{variant:"ghost",size:"iconMd",rounded:!0,"aria-label":o("image-editor.download-image","Download Image"),tooltipContent:o("image-editor.download-image","Download Image"),tooltipContentProps:{side:"bottom"},disabled:"streaming"===t.state||!t.url||d,onClick:x,children:(0,a.jsx)(tu.p,{children:d?(0,a.jsx)(q.y,{size:"xs"}):(0,a.jsx)(tc,{className:"size-5"})},d?"is-downloading":"download-icon")})},"download"),u&&m&&(0,a.jsx)(f.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,a.jsx)(to.w,{variant:"ghost",size:"iconMd",rounded:!0,conversationId:u,responseId:m,iconProps:{size:20}})},"share"),n&&(0,a.jsx)(r.$n,{"aria-label":o("iamge-editor.close","Close Image Editor"),variant:"ghostSecondary",size:"iconMd",rounded:!0,onClick:n,children:(0,a.jsx)($.uv,{size:20})})]})]})})},tf=e=>{let{images:t,selectedImageId:s,onSelect:l}=e,i=(0,p.useRef)(null),n=(0,p.useRef)(null),r=(0,p.useRef)(0),d=(e,t)=>{let s={left:t.scrollLeft,top:t.scrollTop,right:t.scrollLeft+t.clientWidth,bottom:t.scrollTop+t.clientHeight},a={left:e.offsetLeft,top:e.offsetTop,right:e.offsetLeft+e.offsetWidth,bottom:e.offsetTop+e.offsetHeight};return a.left>=s.left&&a.right<=s.right&&a.top>=s.top&&a.bottom<=s.bottom};return(0,p.useEffect)(()=>{if(t.length>0&&i.current&&s){let e=i.current,t=e.querySelector('[data-image-id="'.concat(s,'"]'));t&&!d(t,e)&&t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}},[t.length,s,t]),(0,p.useEffect)(()=>{let e=e=>{if(0===t.length||!s||document.activeElement&&("INPUT"===document.activeElement.tagName||"TEXTAREA"===document.activeElement.tagName))return;let a=t.findIndex(e=>e.id===s);if(-1===a)return;let i=a;switch(e.key){case"ArrowLeft":case"ArrowUp":e.preventDefault(),i=a>0?a-1:t.length-1;break;case"ArrowRight":case"ArrowDown":e.preventDefault(),i=a<t.length-1?a+1:0;break;default:return}let o=Date.now();o-r.current>=150?(r.current=o,l(t[i])):(n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{r.current=Date.now(),l(t[i])},150-(o-r.current)))};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e),n.current&&clearTimeout(n.current)}},[t,s,l]),(0,a.jsx)(f.P.aside,{ref:i,className:"flex @lg:flex-col @lg:max-h-full @lg:w-auto w-fit max-w-full h-auto overflow-auto items-center justify-start gap-2 z-30 px-4 py-1 @lg:px-1 @lg:py-4",variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",children:(0,a.jsx)(P.N,{mode:"popLayout",children:t.map(e=>(0,a.jsx)(f.P.button,{"data-image-id":e.id,className:(0,o.cn)("size-20 shrink-0 relative rounded-xl border bg-background p-1 pointer-events-auto",{"ring-primary ring-2":e.id===s}),onClick:()=>l(e),whileTap:e.id!==s?{scale:.95}:{},variants:{visible:{opacity:1},hidden:{opacity:0},selected:{scale:1.05,opacity:1,transition:{duration:.15}}},initial:"hidden",animate:e.id===s?"selected":"visible",exit:"hidden",children:(0,a.jsx)("div",{className:"relative h-full w-full overflow-hidden rounded-lg",children:(0,a.jsx)("figure",{className:"absolute -translate-x-1/2 left-1/2 h-full aspect-[4/3] pointer-events-none",children:(0,a.jsx)(e7.L,{isModerated:e.isModerated,status:"streaming"===e.state?"streaming":"finished",iconSize:24,intermediateResults:"streaming"===e.state?e.progressMap:[{progress:1,imageUrl:e.url}]})})})},e.id))})},"image-editor-option-nav")};var tx=s(30693),tp=s(34500);let tg=e=>{let{selectedImage:t,isSending:s,isStreaming:l,onSend:i}=e,{editImagePresets:n}=(0,tx.F)(),o=(0,eG.Di)(),[d,c]=(0,p.useState)(null),u=(0,p.useMemo)(()=>!t||l||s,[l,s,t]),m=(0,p.useCallback)(e=>{c(t=>t===e?null:e)},[c]),x=(0,p.useCallback)(e=>{if(t&&!l&&!s)return c(null),i(e.prompt,e.presetId)},[l,t,s,i]);return(0,a.jsx)("div",{className:"flex w-full xs:justify-center justify-start items-center overflow-x-auto xs:overflow-visible gap-2 xs:gap-3 relative z-30 no-scrollbar",children:n.map((e,t)=>(0,a.jsx)(f.P.div,{variants:{hidden:{opacity:0,y:10},visible:{opacity:1,y:0}},initial:"hidden",animate:"visible",transition:{duration:.15,ease:"easeInOut",delay:.06*t},className:"bg-surface-base rounded-full",children:o?(0,a.jsxs)(tp._s,{open:e.category===d,onOpenChange:t=>{t?c(e.category):c(null)},children:[(0,a.jsx)(tp.Uz,{disabled:u,asChild:!0,children:(0,a.jsx)(th,{category:e,disabled:u})}),(0,a.jsxs)(tp.zj,{className:"max-h-[90dvh]",children:[(0,a.jsx)(tp.BE,{children:(0,a.jsxs)(tp.gk,{className:"flex items-center justify-center gap-2",children:[e.icon&&p.createElement(e.icon,{size:20,className:"text-secondary flex-shrink-0"}),e.label]})}),(0,a.jsx)("div",{className:"p-2 space-y-2 overflow-auto",children:e.presets.map(e=>(0,a.jsxs)(r.$n,{variant:"ghost",size:"lg",className:"w-full flex items-center justify-start gap-3 h-auto py-3",onClick:()=>x(e),children:[e.icon&&p.createElement(e.icon,{size:18,className:"text-secondary flex-shrink-0"}),(0,a.jsx)("span",{children:e.label})]},e.presetId))})]})]}):(0,a.jsxs)(w.rI,{open:e.category===d,onOpenChange:()=>m(e.category),children:[(0,a.jsx)(w.ty,{disabled:u,asChild:!0,children:(0,a.jsx)(th,{category:e,disabled:u})}),(0,a.jsx)(w.SQ,{hideWhenDetached:!0,side:"top",sideOffset:8,className:"min-w-60 space-y-0.5",onWheel:e=>e.stopPropagation(),children:e.presets.map(e=>(0,a.jsxs)(w._2,{className:"flex items-center gap-2",onClick:()=>x(e),children:[e.icon&&p.createElement(e.icon,{size:16,className:"text-secondary flex-shrink-0"}),e.label]},e.presetId))})]})},e.category))})},th=p.forwardRef((e,t)=>{let{category:s,disabled:l,...i}=e;return(0,a.jsxs)(r.$n,{ref:t,size:"md",variant:"filledSecondary",rounded:!0,className:(0,o.cn)(!l&&"*:hover:text-primary transition-all"),disabled:l,...i,children:[s.icon&&p.createElement(s.icon,{size:16,className:"flex-shrink-0 text-secondary transition-colors"}),(0,a.jsx)("span",{children:s.label})]})});var tv=s(71090),tj=s(63174),tb=s(30388);let ty=e=>{let{selectedImage:t,isSending:s,isStreaming:l,isWaitingForResponse:i,isAborting:n,inputValue:r,onInputValueChange:d,onSend:c,onAbort:u}=e,{t:m}=(0,g.Bd)("base"),x=(0,p.useRef)(null),h=(0,p.useRef)(null),v=(0,p.useMemo)(()=>l||s||i,[l,s,i]),j=(0,p.useMemo)(()=>!s&&!i&&!l&&!!r.trim(),[s,r,l,i]),b=(0,p.useCallback)(e=>{var t;e.preventDefault(),!v&&r.trim()&&(c(r),null==(t=h.current)||t.focus())},[c,v,r]),y=(0,p.useCallback)(e=>{if(e.stopPropagation(),"Enter"===e.key&&!e.metaKey&&!e.ctrlKey&&!e.shiftKey&&!e.nativeEvent.isComposing){var t;e.preventDefault(),null==(t=x.current)||t.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))}},[]);return(0,a.jsxs)("form",{className:(0,o.cn)("w-full rounded-[32px] p-3 bg-surface-l2 shadow shadow-input-border/10 flex gap-2 pl-5 items-end ring-1 ring-input-border ring-inset"),onSubmit:b,ref:x,children:[(0,a.jsx)(P.N,{children:v&&(0,a.jsx)(f.P.div,{initial:{opacity:0},animate:{opacity:1,transition:{duration:.1}},className:"pb-1.5 -ml-0.5",children:(0,a.jsx)(tb.d,{})},"loading-indicator")}),(0,a.jsx)(tj.A,{ref:h,className:(0,o.cn)("w-full @[480px]/input:px-3 bg-transparent focus:outline-none text-primary align-bottom resize-none pb-1.5 transition-all",v&&"animate-pulse"),onChange:e=>d(e.target.value),value:v?"":r,placeholder:v?m("image-editor.generating","Generating"):t?m("image-editor.describe-edits","Describe your edits"):m("image-editor.describe-image","Describe the image you want"),minRows:1,onKeyDown:y,autoFocus:!0,disabled:v,name:"query",maxRows:5}),(0,a.jsx)("div",{className:(0,o.cn)("ml-auto flex flex-row items-end gap-1"),children:v?(0,a.jsx)(f.P.button,{whileTap:{scale:.95},initial:{scale:.95,opacity:1},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:.5,transition:{duration:.2}},className:(0,o.cn)("group flex flex-col justify-center rounded-full focus:outline-none focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"),disabled:n,onClick:e=>{e.preventDefault(),u()},children:(0,a.jsx)("div",{className:(0,o.cn)("h-9","aspect-square flex flex-col items-center justify-center rounded-full","rounded-full ring-1 ring-inset","bg-primary text-background ring-button-outline-border"),children:(0,a.jsx)(tv.A,{size:20})})}):(0,a.jsx)(f.P.button,{initial:{opacity:.5},animate:{opacity:1,transition:{duration:.1}},whileHover:t?{scale:1.1}:void 0,whileTap:t?{scale:.95}:void 0,className:(0,o.cn)("group flex flex-col justify-center rounded-full focus:outline-none focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"),type:"submit","aria-label":m("image-editor.submit","Submit"),disabled:!j,children:(0,a.jsx)("div",{className:(0,o.cn)("h-9 relative","aspect-square flex flex-col items-center justify-center","rounded-full ring-1 ring-inset duration-100","before:absolute before:inset-0 before:rounded-full before:bg-primary before:ring-0 before:transition-all duration-500",j?"bg-primary text-background ring-transparent before: before:[clip-path:circle(50%_at_50%_50%)]":"bg-button-secondary text-secondary before:[clip-path:circle(0%_at_50%_50%)] ring-0"),children:(0,a.jsx)($.Kp,{size:20,className:"relative"})})})})]})},tI=e=>{let{images:t,selectedImage:s,title:l,inputValue:i,queryBarPosition:n="bottom",onInputValueChange:r,hideHeader:d=!1,hideQueryBar:c=!1,isAborting:u=!1,isSending:m=!1,isStreaming:f=!1,isWaitingForResponse:x=!1,onImageSelect:h,onSendQuery:v,onRegenerate:j,onAbort:b,onImageUpload:y,onClose:I}=e,{t:w}=(0,g.Bd)("base"),[k,N]=(0,e8.M)("image-editor-first-open",!0),[C,S]=(0,p.useState)(!1),[A,E]=(0,p.useState)(!1),[z,R]=(0,p.useState)(!1),M=(0,p.useMemo)(()=>(0,a.jsx)(te,{selectedImage:s,isPeekingParent:C,setIsPeekingParent:S,isParentImageLoaded:A,isFinalImageLoaded:z,setIsFinalImageLoaded:R,setIsParentImageLoaded:E}),[s,C,A,z]),P=(0,p.useMemo)(()=>"center"===n&&!f&&!s&&!x&&!c,[n,f,s,x,c]);return(0,p.useEffect)(()=>{if(null==s?void 0:s.url){R(!1);let e=new Image;e.onload=()=>R(!0),e.src=s.url}},[null==s?void 0:s.url]),(0,p.useEffect)(()=>{if(null==s?void 0:s.parentImageUrl){E(!1);let e=new Image;e.onload=()=>E(!0),e.src=null==s?void 0:s.parentImageUrl}},[null==s?void 0:s.parentImageUrl]),(0,p.useEffect)(()=>{k&&(N(!1),H.oR.message((0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-fg-primary font-bold",children:w("image-editor-welcome.title","Welcome to Image Editor")}),(0,a.jsx)("p",{className:"text-fg-secondary",children:w("image-editor-welcome.description","A focused space for you to transform images with Grok to anything you can imagine.")})]}),{duration:7e3}))},[k,N,w]),(0,a.jsxs)("div",{className:"flex flex-col items-center justify-between w-full h-full relative @container",children:[(0,a.jsxs)("div",{className:(0,o.cn)("flex flex-col gap-8 w-full mb-6 sm:mb-10",{"sm:mb-0":d&&!s}),children:[!d&&(0,a.jsx)(tm,{selectedImage:s,title:l,isSending:m,onRegenerate:j||(()=>{}),onClose:I}),s&&t.length>1&&(0,a.jsxs)("div",{className:"w-full h-[88px] @lg:h-auto relative @lg:absolute @lg:w-auto @lg:right-0 @lg:bottom-0 @lg:top-14 grid place-items-center @lg:mx-0",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 -right-3 bg-gradient-to-l w-8 @lg:bottom-auto @lg:right-0 @lg:left-0 @lg:w-full @lg:-top-3 @lg:h-8 @lg:bg-gradient-to-b from-surface-l1 via-surface-l1 dark:from-surface-inset dark:via-surface-inset to-transparent z-40"}),(0,a.jsx)("div",{className:"absolute inset-y-0 -left-3 bg-gradient-to-r w-8 @lg:top-auto  @lg:right-0 @lg:left-0 @lg:w-full @lg:-bottom-3 @lg:h-8 @lg:bg-gradient-to-t from-surface-l1 via-surface-l1 dark:from-surface-inset dark:via-surface-inset to-transparent z-40"}),t.length>1&&(0,a.jsx)(tf,{images:t,selectedImageId:s.id,onSelect:h||(()=>{})})]})]}),x||f&&!s?(0,a.jsx)(e9,{}):s?M:(0,a.jsx)("div",{className:"w-full h-full max-w-7xl",children:(0,a.jsx)(tr,{onUploadImage:y||(()=>{}),children:P&&(0,a.jsx)("div",{className:"w-full max-w-xl",children:(0,a.jsx)(ty,{selectedImage:s,isWaitingForResponse:x,isStreaming:f,isSending:m,isAborting:u,inputValue:i||"",onInputValueChange:r||(()=>{}),onSend:v||(()=>{}),onAbort:b||(()=>{})})})})}),!P&&(0,a.jsx)("footer",{className:"relative w-full max-w-2xl h-16 flex-shrink-0 mt-12 sm:mt-20",children:(0,a.jsxs)("div",{className:"absolute bottom-0 inset-x-0 flex flex-col gap-4",children:[!!s&&(0,a.jsx)(tg,{isStreaming:f,isSending:m,selectedImage:s,onSend:v||(()=>{})}),!c&&(0,a.jsx)(ty,{selectedImage:s,isWaitingForResponse:x,isSending:m,isStreaming:f,isAborting:u,inputValue:i||"",onInputValueChange:r||(()=>{}),onSend:v||(()=>{}),onAbort:b||(()=>{})})]})})]})};var tw=s(35501);let tk=()=>{let{push:e}=(0,C.wK)(),{t}=(0,g.Bd)("base"),{ASSET_SERVER_URL:s}=(0,e5.v)(),l=(0,L.h)(),i=(0,d.R)(e=>e.loadRecent),n=(0,h.aP)(x.A("streamedMessageId")),o=(0,h.aP)(x.A("conversationId")),c=(0,h.aP)(x.A("setConversationId")),u=(0,h.aP)(x.A("setStreamedMessageId")),m=(0,e3.A3)(x.A("byId")),f=(0,e3.A3)(e=>e.byId[null!=n?n:""]),[v,j]=(0,p.useState)(!1),[b,y]=(0,p.useState)(!1),[I,w]=(0,p.useState)(""),[k,N]=(0,p.useState)([]),[S,A]=(0,p.useState)(null),[E,z]=(0,p.useState)(!1),[R,M]=(0,p.useState)(!1),[P,T]=(0,p.useState)(!1),D=(0,p.useMemo)(()=>k.find(e=>e.id===S)||null,[k,S]),_=(0,p.useCallback)(e=>{let a=e3.A3.getState().byId[e.parentResponseId||""],l="streaming"===e.state;return Object.entries(e.streamingImageById||{}).map(i=>{let[n,r]=i,o=Object.keys(r).map(Number),d=r[Math.max(...o)];return{id:n,url:(0,e2.sU)(s,d.imageUrl),state:l?"streaming":"completed",isModerated:!1,title:(null==a?void 0:a.imageEditUri)?t("image-editor.edited-image","Edited image"):t("image-editor.generated-image","Generated image"),description:null==a?void 0:a.message,regenResponseId:null==a?void 0:a.responseId,progressMap:l?o.map(e=>({progress:e/100,imageUrl:(0,e2.sU)(s,r[e].imageUrl)})):void 0,generatedImageWidth:l?e.generatedImageWidth:void 0,generatedImageHeight:l?e.generatedImageHeight:void 0}})},[s,t]),B=(0,p.useCallback)(e=>{e.length&&N(t=>{if(t.find(e=>e.id.includes("optimistic-streaming-image"))){let a=t.filter(e=>!e.id.includes("optimistic-streaming-image")).concat(e);if(!a.some(e=>e.id===S)){var s;A((null==(s=a[a.length-1])?void 0:s.id)||null)}return a}{let s=t.map(t=>e.find(e=>e.id===t.id)||t),a=e.filter(e=>!s.some(t=>t.id===e.id));return[...s,...a]}})},[N,S]),O=(0,p.useCallback)(t=>{var s;return e({page:"files",fileId:null!=(s=t.fileMetadataId)?s:null,emptyView:"default"}),i()},[e,i]),U=(0,p.useCallback)(()=>{e({page:"files",fileId:null,emptyView:"default"})},[e]),F=(0,p.useCallback)(e=>{let t=e4.C$.getState(),s=h.aP.getState();"none"!==s.reasoningMode&&s.setReasoningMode("none");let a={message:e,toolOverrides:{imageGen:!0},enableRetries:l.ENABLE_AUTO_STREAM_RETRY};return j(!0),M(!1),T(!0),w(""),s.establishNewConversation({...a,temporary:t.isIncognito,disableToolComposer:!0,toolOverrides:{imageGen:!0},ff:l})},[l,w]),W=(0,p.useCallback)(()=>{if(!o||!n)return;let e=e3.A3.getState();return y(!0),e.abortStream(o,n).then(()=>{c(void 0),u(void 0),j(!1),N([]),A(null),z(!1)}).finally(()=>{y(!1)})},[n,o,c,u]),V=(0,p.useCallback)(()=>{P&&(T(!1),H.oR.error(t("image-editor.failed-to-generate","Failed to generate image"))),c(void 0),j(!1),y(!1),N([]),A(null),z(!1)},[t,c,P]);return(0,p.useEffect)(()=>{if(!R)if(f&&"streaming"===f.state){let e=_(f);if(!f.imageAttachmentCount||e.length||E)(null==e?void 0:e.length)&&(B(e),j(!1));else{let e=Array.from({length:f.imageAttachmentCount}).map((e,s)=>({id:"optimistic-streaming-image-".concat(s),url:"",state:"streaming",isModerated:!1,title:t("image-editor.generated-image","Generated image"),description:f.message,progressMap:[],generatedImageWidth:f.generatedImageWidth,generatedImageHeight:f.generatedImageHeight}));N(t=>[...t,...e]),A(e[0].id),z(!0)}}else if(f&&("error"===f.state||f.error))V();else{j(!1),z(!1);let t=[];if(f&&"closed"===f.state){var s,a,l,n;t=_(f);let r=null==(n=f.streamingImageById)||null==(a=n[null==(l=Object.keys(f.streamingImageById||{}))?void 0:l[0]])||null==(s=a[100])?void 0:s.assetId;t.length>0&&!R&&r&&(M(!0),i().then(()=>(c(void 0),u(void 0),e({page:"files",fileId:r}))).catch(V))}B(t)}},[f,_,B,N,t,v,E,S,m,R,V,e,i,c,u]),(0,a.jsx)(eq.YZ,{direction:"horizontal",autoSaveId:"workbench",className:"bg-surface-l1 dark:bg-surface-inset",children:(0,a.jsx)(eq.Zk,{order:1,minSize:50,defaultSize:100,className:"flex flex-col max-h-[100vh] h-[100vh]",children:(0,a.jsxs)("div",{className:"flex flex-col h-full max-h-full",children:[(0,a.jsx)("div",{className:"h-12 min-h-12 flex items-center justify-end px-4",children:(0,a.jsx)(r.$n,{"aria-label":t("image-editor.close","Close Image Editor"),variant:"ghostSecondary",size:"iconMd",rounded:!0,onClick:U,children:(0,a.jsx)($.uv,{className:"size-5"})})}),(0,a.jsx)("div",{className:"flex-1 relative overflow-hidden",children:(0,a.jsx)("div",{className:"w-full max-w-full relative h-full max-h-full",children:(0,a.jsx)(e6.t,{fallbackRender:()=>(0,a.jsx)(tw.f,{}),children:(0,a.jsx)("div",{className:"flex flex-col h-full max-h-full p-2 lg:p-6 pt-8 w-full bg-surface-l1 dark:bg-surface-inset",children:(0,a.jsx)(tI,{queryBarPosition:"center",isStreaming:!!f&&"streaming"===f.state,selectedImage:D,images:k,isWaitingForResponse:v,isAborting:b,inputValue:I,hideHeader:!0,onImageSelect:e=>A(e.id),onInputValueChange:w,onSendQuery:F,onImageUpload:O,onAbort:W,onClose:U})})})})})]})})})};var tN=s(97225),tC=s(1729),tS=s(52542),tA=s(50460),tE=s(3209),tz=s(26676),tR=s(35181),tM=s(94215),tP=s(97991);function tT(e){let{asset:t}=e,{t:s}=(0,g.Bd)("files"),l=(0,tP.M)((0,eg.k)(e=>e.recentWorkspaces.map(t=>e.byId[t]).filter(Boolean))),{add:i}=(0,tE.O)(),n=(0,p.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),i().catch((0,_.HX)("add-to-workspace-button:create-workspace"))},[i]);return(0,a.jsxs)(w.rI,{children:[(0,a.jsx)(w.ty,{asChild:!0,children:(0,a.jsx)(r.gx,{variant:"ghost",rounded:!0,size:"iconMd",tooltipContent:s("Add to Workspace","Add to Workspace"),children:(0,a.jsx)($.XR,{size:17})})}),(0,a.jsxs)(w.SQ,{className:"w-[250px] p-2 rounded-3xl flex flex-col gap-0.5 z-[50]",sideOffset:0,children:[!(null==l?void 0:l.length)&&(0,a.jsx)(tA.C,{content:s("No workspaces yet","No workspaces yet"),ctaText:s("Create Workspace","Create Workspace"),onClickCta:n},"no-workspaces"),l.length&&(0,a.jsx)("div",{className:(0,o.cn)("py-1 pl-2 text-sm text-secondary font-semibold sticky top-0"),children:s("Add to Workspace","Add to Workspace")}),l.map(e=>(0,a.jsx)(tD,{workspaceId:e.workspaceId,asset:t},e.workspaceId))]})]},"add-to-workspace-button")}function tD(e){var t;let{workspaceId:s,asset:l}=e,{client:i}=(0,c.useStatsigClient)();(0,tP.M)(e=>e.promiseById[s]);let n=(0,tP.M)(e=>e.fetchGetWorkspace),d=(0,tP.M)(e=>e.byId),u=(0,tR.v)(n(s),{defaultValue:d[s]}),m=null==u?void 0:u.data,{mutate:f,error:x}=(0,tM.mT)(s);(0,tt.Y)("attach-dropdown:attachAsset",x);let{data:g}=(0,tM.UL)(s),h=null==g||null==(t=g.assets)?void 0:t.some(e=>e.assetId===l.assetId),v=(0,p.useCallback)(e=>{l.assetId&&(f({assetId:l.assetId}),i.logEvent("add_to_workspace",void 0,{location:"add-to-workspace-button",workspaceId:s,assetId:l.assetId}))},[f,l,i,s]);return(0,a.jsxs)(r.$n,{className:(0,o.cn)("group/conversation-item pl-2 pr-1 py-1 text-sm","w-full flex flex-row gap-2 text-primary","rounded-2xl"),variant:"ghost",onClick:v,disabled:h,children:[(0,a.jsx)(tz.n,{icon:null==m?void 0:m.icon,sizeClass:"size-4",rounded:!0,buttonSize:"iconXs",disabled:!0}),(0,a.jsx)("span",{className:(0,o.cn)("flex-1 select-none text-nowrap max-w-full overflow-hidden text-left"),style:{maskImage:eS.zU,WebkitMaskImage:eS.zU},children:null==m?void 0:m.name})]})}var t_=s(11875),tB=s(87164),tO=s(42143),tU=s(48756),tF=s(85255);let tL=e=>{var t;let{content:s}=e,[a,l]=(0,p.useState)(void 0),[i,n]=(0,p.useState)(void 0),[r,o]=(0,p.useState)(!1),c=(0,d.R)(e=>e.handleArtifactSelect);(0,p.useEffect)(()=>{n(void 0)},[s]);let u=(0,p.useCallback)(e=>{var t,s;let{artifact:i}=e,r=(null==a?void 0:a.id)===i.id&&(null==a?void 0:a.versionId)===i.versionId;((null==a?void 0:a.incomplete)||!r)&&c(i),l(i),n(null!=(t=i.content)?t:""),o(null!=(s=i.incomplete)&&s)},[c,a]),m=(0,p.useCallback)(()=>{l(void 0),n("")},[n]);return{activeArtifact:a,content:null!=(t=null!=i?i:s)?t:"",isEditing:r,onSetActiveArtifact:u,onClearActiveArtifact:m}};var tW=s(43791),tH=s(87549),tV=s(52371);function t$(e){let{mode:t,setMode:s}=e,{t:l}=(0,g.Bd)("chat");return(0,a.jsx)(tV.tU,{className:"flex-1 flex-row justify-start flex no-a11y-check",defaultValue:"code",value:t,onValueChange:e=>s(e),children:(0,a.jsxs)(tV.j7,{children:[(0,a.jsxs)(tV.Xi,{className:"gap-1",value:"code","aria-label":l("Code","Code"),children:[(0,a.jsx)(J.A,{className:"size-4"}),(0,a.jsx)("span",{className:"hidden md:inline",children:l("Code","Code")})]}),(0,a.jsx)(tV.Xi,{className:"gap-1",value:"preview","aria-label":l("Preview","Preview"),children:(0,a.jsx)("span",{className:"hidden md:inline",children:l("Preview","Preview")})})]})})}var tK=s(47199);let tG=e=>{let{mimetype:t,content:s}=e;if("text/html"===t)return(0,a.jsx)(tK.Z,{srcDoc:s,autofocus:!0})};var tq=s(8800);let tQ=e=>{let{code:t,mimetype:s,consoleRef:a}=e,l=(0,p.useRef)([]),{t:i}=(0,g.Bd)(["chat"]),n=i("code-execution.done","Done"),r=(0,tC.I5)(s),{runCode:o,loading:d,result:c,codeExecutionAvailable:u}=(0,tq.P)(t,r);(0,p.useEffect)(()=>{var e;null==(e=a.current)||e.reset()},[a,t]);let m=(0,p.useCallback)(()=>{var e;null==(e=a.current)||e.reset(),l.current=[],o()},[a,o]);return(0,p.useEffect)(()=>{var e,t,s,i,r,o,d,u;if(!c)return;let{stdout:m,stderr:f,outputFiles:x,success:p}=c;m&&!l.current.includes(m)&&(null==(e=a.current)||e.open(),l.current.push(m),null==(t=a.current)||t.addMessage({type:"log",message:m})),f&&!l.current.includes(f)&&(null==(s=a.current)||s.open(),l.current.push(f),null==(i=a.current)||i.addMessage({type:"error",message:f,disableFixButton:!0}));let g=Object.values(x).join(",");x&&Object.values(x).length>0&&!l.current.includes(g)&&(null==(r=a.current)||r.open(),l.current.push(g),null==(o=a.current)||o.addMessage({type:"log",files:x})),p&&!l.current.includes(n)&&0===l.current.length&&(null==(d=a.current)||d.open(),l.current.push(n),null==(u=a.current)||u.addMessage({type:"system",message:n}))},[a,c,n]),{runCode:m,isCodeRunning:d,codeExecutionResult:c,isCodeExecutionAvailable:u()}},tX=e=>{let{mimetype:t,isCodeExecutionAvailable:s}=e;return s?"run":["text/html"].includes(t)?"preview":"none"},tY={size:18,strokeWidth:2};var tZ=s(96498),tJ=s(88733),t0=(0,s(70402).A)(function(e,t){return t instanceof e||null!=t&&(t.constructor===e||"Object"===e.name&&"object"==typeof t)});function t1(e){return null!=e}var t2=s(4357),t3=s(49042),t4=s(48085);let t5={size:18,strokeWidth:2};var t6=s(1451),t8=s(71205),t7=s(17438),t9=s(52265);let se=e=>{let{file:t,content:s}=e,{client:a}=(0,c.useStatsigClient)(),{ASSET_SERVER_URL:l}=(0,e5.v)(),i=(0,e2.sU)(l,t.fileUri);return{handleDownload:(0,p.useCallback)(()=>{if(i||s)if(a.logEvent("file_content_download_click",void 0,{contentType:t.fileMimeType}),s){let e=new Blob([s],{type:t.fileMimeType});(0,t9.W)(e,t.fileName)}else i&&(0,t9.z)(i,t.fileName)},[a,i,s,t.fileName,t.fileMimeType])}},st={size:18,strokeWidth:2};s(91915);var ss=s(47934);function sa(e){let{asset:t}=e,s=(0,i.B)(t),{t:l}=(0,g.Bd)("files"),{ASSET_SERVER_URL:n}=(0,e5.v)(),{client:o}=(0,c.useStatsigClient)(),d=(0,p.useCallback)(()=>{o.logEvent("file_content_download_click",void 0,{contentType:"unknown"});let e=(0,e2.sU)(n,t.key);if(!e)return;let s=document.createElement("a");s.href=e,s.download="file",document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(e)},[o,n,t.key]);return(0,a.jsx)(tW.U,{editor:(0,a.jsx)(tJ.H,{hideEdit:!0,fileMetadata:s,onClose:()=>{},className:"border-none shadow-none max-w-none"}),assetId:t.assetId,conversationId:t.currentConversationId,editorHeader:(0,a.jsx)(tO.F,{asset:t}),headerButtons:[(0,a.jsx)(r.gx,{tooltipContent:l("Download to file","Download to file"),tooltipContentProps:{className:"text-xs"},tooltipProps:{delayDuration:300},onClick:d,rounded:!0,variant:"ghost",size:"iconMd","aria-label":l("Download to file","Download to file"),children:(0,a.jsx)(t8.A,{strokeWidth:2,size:20})},"download-button")],chat:(0,a.jsx)(ss.s,{asset:t})})}let sl={markdown:function(e){var t,s;let{asset:l}=e,i=(0,L.h)(),{ASSET_SERVER_URL:n}=(0,e5.v)(),{t:c}=(0,g.Bd)("files"),u=(0,d.R)(e=>e.setAssetContent),m=(0,d.H3)(null!=(t=l.assetId)?t:""),{handleCopy:f,copyPressed:x,handleDownload:h,shareLoading:v,handleShare:j,sharePressed:b}=(0,tF.H)({assetId:l.assetId,content:null!=m?m:"",filename:null!=(s=l.name)?s:"file"}),y=(0,d.R)(e=>e.fetchContent);(0,p.useEffect)(()=>{null==m&&l.assetId&&y(l.assetId,n)},[n,l.assetId,m,y]);let I=(0,p.useCallback)(e=>{var t;u(null!=(t=l.assetId)?t:"",e)},[l.assetId,u]),{activeArtifact:w,isEditing:k,onSetActiveArtifact:N}=tL({content:null!=m?m:void 0}),C=(0,t3.l)({content:m,isEditable:!0,onUpdate:I});return(0,a.jsx)(tW.U,{editor:(0,a.jsx)("div",{className:(0,o.cn)("no-a11y-check h-full overflow-auto max-w-full relative prose bg-surface-l1 dark:bg-surface-inset","\n  [&_.tiptap_h1.is-editor-empty:first-child::before]:text-primary/20\n  [&_.tiptap_h1.is-editor-empty:first-child::before]:text-3xl\n  [&_.tiptap_h1.is-editor-empty:first-child::before]:font-bold\n  [&_.tiptap_h1.is-editor-empty:first-child::before]:content-[attr(data-placeholder)]\n  [&_.tiptap_h1.is-editor-empty:first-child::before]:float-left\n  [&_.tiptap_h1.is-editor-empty:first-child::before]:h-0\n  [&_.tiptap_h1.is-editor-empty:first-child::before]:pointer-events-none\n"),children:C&&null!==m?(0,a.jsx)(t2.n,{editor:C,content:m,editable:!k,className:"max-w-3xl h-full justify-self-center"}):null}),assetId:l.assetId,conversationId:l.currentConversationId,editorHeader:(0,a.jsx)(tO.F,{asset:l}),editorSubheader:C?(0,a.jsx)(t4.n,{editable:!0,editor:C}):null,headerButtons:[(0,a.jsx)(r.gx,{tooltipContent:c("Copy Contents","Copy Contents"),tooltipContentProps:{className:"text-xs"},tooltipProps:{delayDuration:300},onClick:f,rounded:!0,variant:"ghost",size:"iconMd","aria-label":c("Copy Contents","Copy Contents"),children:(0,a.jsx)(tu.p,{children:x?(0,a.jsx)(eN.A,{size:16}):(0,a.jsx)(tB.A,{size:17})},x?"copied":"copy")},"copy-button"),(0,a.jsx)(r.gx,{tooltipContent:c("Download to file","Download to file"),tooltipContentProps:{className:"text-xs"},tooltipProps:{delayDuration:300},onClick:h,rounded:!0,variant:"ghost",size:"iconMd","aria-label":c("Download to file","Download to file"),children:(0,a.jsx)(tc,{...t5,size:19})},"download-button"),i.ENABLE_FILE_SHARING?(0,a.jsx)(r.gx,{tooltipContent:c("Share file","Share file"),onClick:j,tooltipContentProps:{className:"text-xs"},variant:"ghost",size:"iconMd","aria-label":c("Share file","Share file"),rounded:!0,children:(0,a.jsx)(tu.p,{children:v?(0,a.jsx)(q.y,{size:"xs"}):b?(0,a.jsx)(eN.A,{size:16}):(0,a.jsx)($.li,{...t5,size:20})},v?"share-loading":b?"shared":"share")},"share-button"):null],chat:(0,a.jsx)(tU.s,{asset:l,activeArtifact:w,onArtifactSelected:N})})},csv:tZ.s,spreadsheet:function(e){var t;let{asset:s}=e,{t:l}=(0,g.Bd)("files"),n=(0,L.h)(),o=(0,i.B)(s),{ASSET_SERVER_URL:c}=(0,e5.v)(),u=(0,d.R)(e=>e.setAssetContent),m=(0,d.fh)(null!=(t=s.assetId)?t:"","binary"),f=(0,d.R)(e=>e.fetchBinaryContent);(0,p.useEffect)(()=>{null==m&&s.assetId&&f(s.assetId,c)},[c,s.assetId,m,f]);let x=(0,p.useCallback)(e=>{var t;u(null!=(t=s.assetId)?t:"",e)},[s.assetId,u]),{handleDownload:h}=se({file:o,content:m});return(0,a.jsx)(tW.U,{editor:(0,a.jsx)("div",{className:"flex flex-col h-full overflow-hidden border-t border-border-l1",children:(0,a.jsx)(t7.bs,{initialState:{name:s.name||"Workbook"},content:m,readOnly:!n.ENABLE_XLSX_EDITING,children:void 0!==m?(0,a.jsx)(t6.y,{readOnly:!n.ENABLE_XLSX_EDITING,onContentUpdate:x}):null},s.assetId)}),assetId:s.assetId,conversationId:s.currentConversationId,editorHeader:(0,a.jsx)(tO.F,{asset:s}),headerButtons:[(0,a.jsx)(r.gx,{tooltipContent:l("Download to file","Download to file"),tooltipContentProps:{className:"text-xs"},tooltipProps:{delayDuration:300},onClick:h,rounded:!0,variant:"ghost",size:"iconMd","aria-label":l("Download to file","Download to file"),disabled:!m,children:(0,a.jsx)(t8.A,{...st,size:20})},"download-button")],chat:(0,a.jsx)(tU.s,{asset:s})})},image:function(e){let{asset:t}=e,{t:s}=(0,g.Bd)("base"),{ASSET_SERVER_URL:l}=(0,e5.v)(),n=(0,L.h)(),[o]=(0,e8.M)("files-tab-is-chat-open",!0),c=(0,d.R)(e=>e.loadRecent),u=(0,d.R)((0,eg.k)(e=>e.assetsById)),m=(0,d.R)((0,eg.k)(e=>e.listStatus)),v=(0,e3.A3)(x.A("byId")),j=(0,h.aP)(x.A("conversationId")),b=(0,h.aP)(x.A("streamedMessageId")),y=(0,h.aP)(x.A("queryByConversationId")),I=(0,h.aP)(x.A("idsetQueryByConversationId")),[w,k]=(0,p.useState)(!1),[N,C]=(0,p.useState)(!1),[S,A]=(0,p.useState)(!1),[E,z]=(0,p.useState)(!1),[R,M]=(0,p.useState)(null),[T,D]=(0,p.useState)(null),[B,O]=(0,p.useState)([]),[U,F]=(0,p.useState)(null),[W,H]=(0,p.useState)(null),V=(0,p.useMemo)(()=>(0,i.B)(t),[t]),K=(0,p.useMemo)(()=>{if(!t.currentConversationId)return[];let e=[];return Object.values(u).map(e=>null==e?void 0:e.data).filter(t1).forEach(s=>{var a;(null==(a=s.mimeType)?void 0:a.startsWith("image/"))&&s.sourceConversationId===t.currentConversationId&&e.push(s)}),e.sort((e,t)=>new Date(e.createTime||"").getTime()-new Date(t.createTime||"").getTime())},[t,u]),G=j||"no_conversation_id",Q=y[G],X=(0,p.useCallback)(e=>I(e,G),[G,I]),Y=(0,p.useMemo)(()=>B.find(e=>e.id===T)||null,[B,T]),Z=(0,p.useMemo)(()=>{let e=K.find(e=>e.assetId===R);return e||t},[t,R,K]),J=(0,e3.A3)(e=>e.byId[null!=b?b:""]),ee=(0,p.useCallback)(e=>{let t=e3.A3.getState().byId[e.parentResponseId||""],s="streaming"===e.state;return Object.entries(e.streamingImageById||{}).map(a=>{let[i,n]=a,r=Object.keys(n).map(Number),o=n[Math.max(...r)];return{id:i,url:(0,e2.sU)(l,o.imageUrl),state:s?"streaming":"completed",isModerated:!1,responseId:e.responseId,regenResponseId:null==t?void 0:t.responseId,progressMap:s?r.map(e=>({progress:e/100,imageUrl:(0,e2.sU)(l,n[e].imageUrl)})):void 0,generatedImageWidth:s?e.generatedImageWidth:void 0,generatedImageHeight:s?e.generatedImageHeight:void 0}})},[l]),et=(0,p.useCallback)(e=>{e.length&&O(t=>{if(t.find(e=>e.id.includes("optimistic-streaming-image"))){let a=t.filter(e=>!e.id.includes("optimistic-streaming-image")).concat(e);if(!a.some(e=>e.id===T)){var s;D((null==(s=a[a.length-1])?void 0:s.id)||null)}return a}{let s=t.map(t=>e.find(e=>e.id===t.id)||t),a=e.filter(e=>!s.some(t=>t.id===e.id));return[...s,...a]}})},[O,T]),es=(0,p.useCallback)(e=>{if(!Y)return;let t=e3.A3.getState(),s=e4.C$.getState(),a=h.aP.getState(),l=a.lastMessageId?t.byId[a.lastMessageId]:void 0;if(a.lastMessageId&&!l)throw Error("Last message is missing");if((null==l?void 0:l.sender)==="human")throw Error("Last message is human");"none"!==a.reasoningMode&&a.setReasoningMode("none");let i={message:e,toolOverrides:{imageGen:!0},imageEditUri:Y.url?Y.url.replace(/^https?:\/\/[^/]+\/?/,""):void 0,enableRetries:n.ENABLE_AUTO_STREAM_RETRY};return C(!0),X(""),a.conversationId?a.sendResponse({...i,parentResponseId:a.lastMessageId,conversationId:a.conversationId,webpageUrls:[],setOpimisticUserResponse:!0,setUserResponse:!0,disableToolComposer:!0,isFromGrokFiles:!0,fileAttachmentIds:[Z.assetId],ff:n}):a.establishNewConversation({...i,temporary:s.isIncognito,disableToolComposer:!0,isFromGrokFiles:!0,fileAttachmentIds:[Z.assetId],ff:n})},[Y,n,X,Z.assetId]),ea=(0,p.useCallback)(()=>{let e=v[(null==Y?void 0:Y.regenResponseId)||""];if(e)return es(e.message)},[Y,v,es]),el=(0,p.useCallback)(()=>{if(!j||!b)return;let e=e3.A3.getState();return A(!0),e.abortStream(j,b).finally(()=>{A(!1)})},[b,j]),ei=(0,p.useCallback)(()=>{var e;!w&&(null==Y?void 0:Y.url)&&(k(!0),(0,td.G)(Y.url,null==(e=Y.url)?void 0:e.split("/").pop()).catch((0,_.HX)("image-editor:handleDownload")).finally(()=>k(!1)))},[w,Y]);(0,p.useEffect)(()=>{if(J&&"streaming"===J.state&&J.conversationId===j){let e=ee(J);if(!J.imageAttachmentCount||e.length||E)(null==e?void 0:e.length)&&(et(e),C(!1));else{let e=Array.from({length:J.imageAttachmentCount}).map((e,t)=>({id:"optimistic-streaming-image-".concat(t),url:"",state:"streaming",isModerated:!1,responseId:J.responseId,progressMap:[],generatedImageWidth:J.generatedImageWidth,generatedImageHeight:J.generatedImageHeight}));O(t=>[...t,...e]),D(e[0].id),z(!0)}}else{C(!1),z(!1);let e=[];J&&"closed"===J.state&&J.conversationId===j&&(e=ee(J),U!==J.responseId&&(F(J.responseId),c().catch((0,_.HX)("image-editor:loadRecent")))),et(e)}},[J,ee,et,O,s,N,E,v,T,c,U,t.assetId,K,j]);let en=(0,p.useCallback)(async()=>{let e=e3.A3.getState();if(t.currentConversationId){let s=[null==t?void 0:t.responseId,...K.map(e=>null==e?void 0:e.responseId)].filter(t0(String)),a=await e.loadResponses(t.currentConversationId,s),n=a.find(e=>(null==e?void 0:e.responseId)===(null==t?void 0:t.responseId)),r=n?e.byId[n.parentResponseId||""]:void 0,o=(0,i.B)(t);return[{id:t.assetId||"",state:"completed",isModerated:!1,url:(0,e2.sU)(l,o.fileUri||""),responseId:t.responseId,parentImageUrl:(null==r?void 0:r.imageEditUri)?(0,e2.sU)(l,r.imageEditUri):void 0,regenResponseId:null==r?void 0:r.responseId},...K.sort((e,t)=>new Date(e.createTime||"").getTime()-new Date(t.createTime||"").getTime()).map(e=>{let t=(0,i.B)(e),s=a.find(t=>(null==t?void 0:t.responseId)===(null==e?void 0:e.responseId)),n=s?a.find(e=>(null==e?void 0:e.responseId)===(null==s?void 0:s.parentResponseId)):void 0;return{id:e.assetId||"",state:"completed",isModerated:!1,url:(0,e2.sU)(l,t.fileUri||""),responseId:e.responseId,parentImageUrl:(null==n?void 0:n.imageEditUri)?(0,e2.sU)(l,n.imageEditUri):void 0,regenResponseId:null==n?void 0:n.responseId}})]}if(t.sourceConversationId){let s=[null==t?void 0:t.responseId].filter(t0(String)),a=await e.loadResponses(t.sourceConversationId,s),n=(0,i.B)(t),r=a.find(e=>(null==e?void 0:e.responseId)===(null==t?void 0:t.responseId)),o=r?a.find(e=>(null==e?void 0:e.responseId)===(null==r?void 0:r.parentResponseId)):void 0;return[{id:t.assetId||"",state:"completed",isModerated:!1,url:(0,e2.sU)(l,n.fileUri||""),responseId:t.responseId,parentImageUrl:(null==o?void 0:o.imageEditUri)?(0,e2.sU)(l,o.imageEditUri):void 0,regenResponseId:null==o?void 0:o.responseId}]}{let e=(0,i.B)(t);return[{id:t.assetId||"",state:"completed",isModerated:!1,url:(0,e2.sU)(l,e.fileUri||""),responseId:t.responseId}]}},[l,t,K]),er=(0,p.useCallback)(e=>{var t;if(B.some(t=>t.id===T&&t.responseId===e))return;let s=null==(t=B.find(t=>t.responseId===e))?void 0:t.id;s&&D(s)},[B,T]);return(0,p.useEffect)(()=>{t.assetId&&t.assetId!==W&&"ready"===m&&(H(t.assetId),en().then(e=>{O(e),D(t.assetId),F(null),z(!1),C(!1),A(!1)}).catch((0,_.HX)("image-editor:getInitialImages")))},[t.assetId,m,W,en]),(0,p.useEffect)(()=>{if(T&&T!==R){if(T===t.assetId||K.some(e=>e.assetId===T))M(T);else if(null==Y?void 0:Y.responseId){var e,s,a;let t=v[(null==Y?void 0:Y.responseId)||""],l=null==t||null==(a=t.streamingImageById)||null==(s=a[T])||null==(e=s[100])?void 0:e.assetId;l&&M(l)}}},[T,R,t.assetId,K,v,Y]),n.ENABLE_IMAGE_EDITOR_IN_FILES?(0,a.jsx)(tW.U,{editor:(0,a.jsx)("div",{className:"flex flex-col h-full max-h-full p-2 lg:p-6 pt-8 w-full",children:(0,a.jsx)(tI,{hideHeader:!0,hideQueryBar:o,isStreaming:J&&"streaming"===J.state,selectedImage:Y,images:B,isWaitingForResponse:N||!Y,isAborting:S,inputValue:Q,onInputValueChange:X,onImageSelect:e=>D(e.id),onSendQuery:es,onAbort:el})}),assetId:t.assetId,conversationId:t.currentConversationId,editorHeader:(0,a.jsx)(P.N,{mode:"popLayout",children:(null==Y?void 0:Y.state)==="streaming"?(0,a.jsx)(f.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},className:"text-lg font-semibold text-primary animate-pulse",children:s("image-editor.generating","Generating")},"streaming-title"):(0,a.jsx)(f.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},className:"flex-grow",children:(0,a.jsx)(tO.F,{asset:Z,className:"text-lg font-semibold text-primary truncate min-w-0 overflow-hidden"})},J&&"streaming"===J.state?T:Z.assetId)}),headerButtons:[(null==Y?void 0:Y.state)&&["streaming","error","completed"].includes(Y.state)&&(null==Y?void 0:Y.regenResponseId)&&(0,a.jsx)(r.gx,{size:"iconMd",variant:"ghost",rounded:!0,"aria-label":s("image-editor.regenerate","Regenerate Image"),tooltipContent:s("image-editor.regenerate","Regenerate Image"),tooltipContentProps:{side:"bottom"},asChild:!0,disabled:J&&"streaming"===J.state||N,onClick:ea,children:(0,a.jsx)(f.P.button,{whileTap:(null==Y?void 0:Y.state)==="streaming"||N?void 0:{scale:.9},children:(0,a.jsx)($.V$,{className:"size-5"})})},"regenerate"),Y&&(0,a.jsx)(r.gx,{variant:"ghost",size:"iconMd",rounded:!0,"aria-label":s("image-editor.download-image","Download Image"),tooltipContent:s("image-editor.download-image","Download Image"),tooltipContentProps:{side:"bottom"},disabled:"streaming"===Y.state||!Y.url||w,onClick:ei,children:(0,a.jsx)(tu.p,{children:w?(0,a.jsx)(q.y,{size:"xs"}):(0,a.jsx)(tc,{className:"size-5"})},w?"is-downloading":"download-icon")},"download")],chat:(0,a.jsx)(tU.s,{asset:t,viewedAssetId:R||void 0,onResponseImagesOpen:er,responseImagesView:"status-card"},t.assetId)}):(0,a.jsx)("div",{className:"flex flex-col max-h-[100vh] h-[100vh]",children:(0,a.jsx)("div",{className:"flex items-center justify-center h-full bg-surface-base",children:(0,a.jsx)(tJ.H,{hideEdit:!0,fileMetadata:V,onClose:()=>{},className:"border-none shadow-none max-w-none"})})})},code:function(e){var t,s,l,n;let{asset:o}=e,u=(0,L.h)(),{ASSET_SERVER_URL:m}=(0,e5.v)(),{t:f}=(0,g.Bd)("files"),x=(0,c.useStatsigClient)(),h=(0,d.R)(e=>e.setAssetContent),v=(0,d.H3)(null!=(t=o.assetId)?t:""),j=(0,d.R)(e=>e.fetchContent);(0,p.useEffect)(()=>{null==v&&o.assetId&&j(o.assetId,m)},[m,o.assetId,v,j]);let b=(0,p.useRef)(null),y=(0,i.B)(o),{activeArtifact:I,isEditing:w,onSetActiveArtifact:k}=tL({content:null!=v?v:void 0}),{runCode:N,isCodeRunning:C,isCodeExecutionAvailable:S}=tQ({code:null!=v?v:"",mimetype:null!=(s=y.fileMimeType)?s:"",consoleRef:b}),A=(0,p.useCallback)(()=>{N(),x.logEvent("files.workbench.run-code")},[N,x]),E=(0,p.useCallback)(e=>{var t;h(null!=(t=o.assetId)?t:"",null!=e?e:"")},[o.assetId,h]),z=tX({content:null!=v?v:"",mimetype:y.fileMimeType,isCodeExecutionAvailable:S}),{handleCopy:R,copyPressed:M,handleDownload:P,handleShare:T,sharePressed:D,shareLoading:_}=(0,tF.H)({assetId:o.assetId,content:null!=v?v:"",filename:null!=(l=o.name)?l:"file"}),B=(0,tC.I5)(y.fileMimeType),[O,U]=(0,p.useState)("code"),F=(0,p.useCallback)(e=>{U(e),x.logEvent("files.workbench.set-mode",e)},[x]);return(0,p.useEffect)(()=>{U("code")},[o.assetId]),(0,a.jsx)(tW.U,{editor:"code"===O?(0,a.jsxs)("div",{className:"flex flex-col h-full overflow-hidden bg-surface-inset",children:[(0,a.jsx)("div",{className:"relative flex-1 h-full overflow-hidden",children:(0,a.jsx)(tH.B,{editable:!0,onContentUpdate:E,isStreaming:w,value:null!=v?v:"",syntax:B})}),(0,a.jsx)(tS.C,{ref:b})]}):(0,a.jsx)(tG,{mimetype:null!=(n=o.mimeType)?n:"unknown",content:null!=v?v:""}),chat:(0,a.jsx)(tU.s,{asset:o,activeArtifact:I,onArtifactSelected:k}),editorHeader:(0,a.jsx)(tO.F,{asset:o}),assetId:o.assetId,conversationId:o.currentConversationId,headerButtons:["preview"===z?(0,a.jsx)(t$,{mode:O,setMode:F}):null,"run"===z?(0,a.jsx)("div",{className:"py-1",children:(0,a.jsxs)(r.$n,{variant:"outline",size:"sm",className:"rounded-full",onClick:A,disabled:C,children:[C?(0,a.jsx)(q.y,{size:"xs"}):(0,a.jsx)(t_.A,{...tY,size:16}),f("code-execution.run","Run")]})}):null,(0,a.jsx)(tT,{asset:o},"add-to-workspace-button"),(0,a.jsx)(r.gx,{tooltipContent:f("Copy Contents","Copy Contents"),tooltipContentProps:{className:"text-xs"},tooltipProps:{delayDuration:300},onClick:R,rounded:!0,variant:"ghost",size:"iconMd","aria-label":f("Copy Contents","Copy Contents"),children:(0,a.jsx)(tu.p,{children:M?(0,a.jsx)(eN.A,{size:16}):(0,a.jsx)(tB.A,{size:17})},M?"copied":"copy")},"copy-button"),(0,a.jsx)(r.gx,{tooltipContent:f("Download to file","Download to file"),tooltipContentProps:{className:"text-xs"},tooltipProps:{delayDuration:300},onClick:P,rounded:!0,variant:"ghost",size:"iconMd","aria-label":f("Download to file","Download to file"),children:(0,a.jsx)(tc,{...tY,size:19})},"download-button"),u.ENABLE_FILE_SHARING?(0,a.jsx)(r.gx,{tooltipContent:f("Share file","Share file"),onClick:T,tooltipContentProps:{className:"text-xs"},variant:"ghost",size:"iconMd","aria-label":f("Share file","Share file"),rounded:!0,children:(0,a.jsx)(tu.p,{children:_?(0,a.jsx)(q.y,{size:"xs"}):D?(0,a.jsx)(eN.A,{size:16}):(0,a.jsx)($.li,{...tY,size:20})},_?"share-loading":D?"shared":"share")},"share-button"):null]})},unknown:sa};function si(e){var t;let{rootAssetId:s}=e,{t:l}=(0,g.Bd)("files"),{setOpen:i}=(0,tN.cL)(),n=(0,d.R)((0,eg.k)(e=>e.fetchVersions)),r=(0,d.R)(e=>{var t;return null==(t=e.assetsById[s])?void 0:t.status}),o=(0,d.F7)(s);if((0,p.useEffect)(()=>{n(s)},[s,n]),(0,p.useEffect)(()=>{i(!1)},[]),!o&&"success"===r)return(0,a.jsx)(tw.f,{title:l("file-not-found.title","File not found"),message:l("file-not-found.message","We couldn’t find the document. Please verify the link you entered and try again. You can also browse for your files in the Files panel.")});if(!o&&"error"===r)return(0,a.jsx)(tw.f,{});if(!o)return(0,a.jsx)(e_.P,{delayMs:500,children:(0,a.jsx)("div",{className:"flex w-full h-full justify-center items-center",children:(0,a.jsx)(q.y,{})})});let c=null!=(t=sl[(0,el.qW)(o)])?t:sa;return(0,a.jsx)(c,{asset:o})}function sn(){var e;let{client:t}=(0,c.useStatsigClient)(),{t:s}=(0,g.Bd)("files"),{ENABLE_FILES_PAGE:l,ENABLE_IMAGE_EDITOR_IN_FILES:i}=(0,L.h)(),{route:n,push:r}=(0,C.wK)(),u=(0,eG.Di)(),m="files"===n.page&&null!=(e=n.fileId)?e:void 0,f=(0,d.R)(e=>{var t,s;return m?null==(s=e.assetsById[e.currentVersion[m]])||null==(t=s.data)?void 0:t.name:""});(0,p.useEffect)(()=>{t.logEvent("files.open",m)},[m,t]),(0,e$.r)(f||s("files-page-title","Files"));let x=(0,p.useRef)(null),h=(0,d.R)(e=>e.isFileExplorerCollapsed),[v,b]=(0,p.useState)(!1);if((0,p.useEffect)(()=>{let e=x.current;if(e){if(h&&e.isExpanded()){e.collapse(),b(!0);let t=setTimeout(()=>{b(!1)},300);return()=>clearTimeout(t)}else if(!h&&e.isCollapsed()){e.expand(),b(!0);let t=setTimeout(()=>{b(!1)},300);return()=>clearTimeout(t)}}},[h]),(0,eK.v)(eV.Ib,e=>{e.preventDefault(),e.stopPropagation(),r({page:"main"}),t.logEvent("pressed_cmd_j",void 0)},[t,r]),!l||"files"!==n.page)return(0,a.jsx)(F.default,{});if(u)return(0,a.jsx)(U,{});let{fileId:y,emptyView:I}=n;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(eq.YZ,{autoSaveId:"files-page-layout",style:{height:"100vh"},direction:"horizontal",className:"w-full h-[100vh] overflow-hidden",tagName:"main",children:[(0,a.jsx)(eq.Zk,{minSize:20,defaultSize:20,order:0,collapsible:!0,ref:x,onCollapse:()=>d.R.getState().setIsFileExplorerCollapsed(!0),onExpand:()=>d.R.getState().setIsFileExplorerCollapsed(!1),className:(0,o.cn)(v?"transition-all duration-300":""),children:(0,a.jsx)(eH,{className:"h-full"})}),(0,a.jsx)(sr,{}),(0,a.jsx)(eq.Zk,{order:1,minSize:0,defaultSize:100,className:"relative",children:y?(0,a.jsx)(si,{rootAssetId:y}):"image"===I&&i?(0,a.jsx)(tk,{}):(0,a.jsx)(eJ,{})})]}),(0,a.jsx)(j.CommandMenu,{})]})}function sr(){return(0,a.jsx)(eq.TW,{className:"border-l border-input-border data-[resize-handle-state=hover]:border-border-l3 z-50"})}var so=s(5861),sd=s(8978),sc=s(35692),su=s(32006),sm=s(93587),sf=s(73304),sx=s(31643),sp=s(47416),sg=s(31905),sh=s(10684),sv=s(8757),sj=s(2010),sb=s(35589),sy=s(16506),sI=s(39116);function sw(e){let{children:t,numOfLines:s,...l}=e;return(0,a.jsx)("p",{style:{display:"-webkit-box",WebkitLineClamp:s,WebkitBoxOrient:"vertical",overflow:"hidden"},...l,children:t})}function sk(e){let{task:t,onClick:s}=e,{client:l}=(0,c.useStatsigClient)(),{getScheduleLabel:i}=(0,su.Ik)(),n=(0,sf.d)(x.A("handleSetCreateDialog")),r=(0,sf.d)(x.A("handleSetTaskToEdit")),d=(0,p.useCallback)(()=>{l.logEvent("task_preset_clicked",void 0,{}),n(!0),r(t),null==s||s()},[n,r,s,l,t]),u=(0,su.O$)(t),m=(0,p.useMemo)(()=>{var e,t;if(u)return i(u.cadence,u.timeOfDay,u.ianaTimezone,u.localDayOfWeek,u.localDayOfMonth,null!=(t=null==(e=u.localDayOfYear)?void 0:e.toISODate())?t:void 0)},[i,u]),{resolvedTheme:f}=(0,sy.D)();return(0,a.jsxs)("div",{className:(0,o.cn)("group h-40 grow rounded-2xl pt-4 px-4 flex flex-col items-center gap-3 border cursor-pointer bg-surface-l1 hover:bg-surface-l2",{"hover:bg-surface-inset":"light"===f}),onClick:d,children:[(0,a.jsx)("h1",{className:"font-semibold text-sm",children:t.name}),(0,a.jsxs)("div",{className:"grow w-full rounded-t-xl border bg-surface-l2 overflow-hidden p-3 group-hover:bg-surface-l3",children:[(0,a.jsx)(sw,{className:"text-xs text-fg-secondary font-normal mb-2",numOfLines:2,children:t.prompt}),(0,a.jsx)("p",{className:"text-xs font-normal",children:m})]})]})}var sN=function(e){return e[e.ACTIVE=0]="ACTIVE",e[e.COMPLETED=1]="COMPLETED",e[e.ARCHIVED=2]="ARCHIVED",e}(sN||{});function sC(){let e=(0,L.h)(),{t}=(0,g.Bd)("tasks"),{getUserTasksQuery:s,getInactiveUserTasksQuery:l}=(0,su.ek)(),i=(0,sf.d)(x.A("handleSetCreateDialog")),n=(0,sf.d)(x.A("handleSetSelectedTask")),{taskPresets:d}=(0,su.Ik)(),u=(0,eG.Di)(),{client:m}=(0,c.useStatsigClient)(),{route:h}=(0,C.wK)(),v="tasks"===h.page&&h.taskId||null,b="tasks"===h.page&&h.tab||null,y=(0,p.useRef)(null),[I,w]=(0,p.useState)(!0),[k,N]=(0,p.useState)(!1),[S,A]=(0,p.useState)({}),E=(0,p.useCallback)((e,t)=>{A(s=>({...s,[e]:t}))},[A]);(0,p.useEffect)(()=>{let e=t("tasks-page-document-title","Tasks");document.title="".concat(e," - Grok")},[t]),(0,e$.r)(t("tasks-page-document-title","Tasks")),(0,p.useEffect)(()=>{m.logEvent("opened_tasks_page",void 0,{})},[m]);let[z,R]=(0,p.useState)(2*("archived"===b)),M=!!(0,K.wV)().user,P=e.ENABLE_GROK_TASKS&&M,{isLoading:D,data:_,refetch:B,isRefetching:O}=s,{isLoading:U,data:F,refetch:W,isRefetching:V}=l,$=2===z?U:D,G=2===z?V:O;(0,p.useEffect)(()=>{let e=()=>{if(y.current){let{scrollTop:e,scrollHeight:t,clientHeight:s}=y.current;0===e?w(!0):w(!1),e+s>=t-5?N(!0):N(!1)}},t=y.current;return t&&t.addEventListener("scroll",e),()=>{t&&t.removeEventListener("scroll",e)}},[y,$]);let Q=(0,p.useCallback)(async()=>2===z?W():B(),[z,B,W]),X=(0,p.useMemo)(()=>2===z?null==F?void 0:F.tasks:null==_?void 0:_.tasks,[z,null==F?void 0:F.tasks,null==_?void 0:_.tasks]),Y=(0,p.useCallback)(()=>{R(0)},[]),Z=(0,p.useCallback)(()=>{R(2)},[]),J=(0,p.useCallback)(async()=>{m.logEvent("refresh_tasks_clicked",void 0,{}),Q().catch(e=>H.oR.error(e))},[Q,m]),ee=(0,p.useCallback)(()=>(0,a.jsxs)("div",{className:"rounded-xl border p-0.5 flex items-center gap-1 bg-surface-inset",children:[(0,a.jsx)(r.$n,{variant:0===z?"filledSecondary":"ghost",onClick:Y,size:"sm",className:(0,o.cn)("px-3 rounded-[0.5rem] font-semibold",{"text-primary":0===z,"text-fg-secondary":0!==z}),children:t("tasks-toggle.active","Active")}),(0,a.jsx)(r.$n,{variant:2===z?"filledSecondary":"ghost",onClick:Z,size:"sm",className:(0,o.cn)("px-3 rounded-[0.5rem] font-semibold",{"text-primary":2===z,"text-fg-secondary":2!==z}),children:t("tasks-toggle.archived","Archived")})]}),[t,z,Y,Z]),et=(0,p.useCallback)(()=>{m.logEvent("clicked_add_new_task",void 0,{location:"tasks-page"}),i(!0),R(0)},[i,m]),es=(0,p.useCallback)(()=>(0,a.jsxs)("div",{className:"w-full py-8 border rounded-xl flex flex-col items-center gap-4 px-4",children:[(0,a.jsx)(r.$n,{size:"iconMd",variant:"secondary",className:"rounded-full",onClick:et,"aria-label":t("tasks.create","Add new"),children:(0,a.jsx)(sp.A,{size:20})}),(0,a.jsxs)("div",{className:"flex flex-col items-center w-full gap-2 text-lg font-semibold",children:[(0,a.jsx)("h1",{children:t("no-tasks-banner.title","Get started by adding a task")}),(0,a.jsx)("p",{className:"text-xs font-normal text-fg-secondary text-center leading-1",children:t("no-tasks-banner.subtitle","Schedule a task to automate actions and get reminders when they complete.")})]})]}),[et,t]),ea=(0,p.useCallback)(()=>(0,a.jsxs)("div",{className:"w-full py-8 border rounded-xl flex flex-col items-center gap-4",children:[(0,a.jsx)("div",{className:"flex items-center justify-center rounded-full bg-surface-l1 p-4",children:(0,a.jsx)(sg.A,{size:20})}),(0,a.jsxs)("div",{className:"flex flex-col items-center w-full gap-2 text-lg font-semibold",children:[(0,a.jsx)("h1",{children:t("no-archived-tasks-banner.title","No archived tasks")}),(0,a.jsx)("p",{className:"text-xs font-normal text-fg-secondary text-center leading-1",children:t("no-archived=tasks-banner.subtitle","Archived tasks will show up here")})]})]}),[t]),el=(0,p.useMemo)(()=>{if(!X)return[];if(0===z){var e;return e=X.filter(e=>{var t;return null==(t=e.task)?void 0:t.isActive}),e.sort((e,t)=>{var s,a,l,i;let n=S[null!=(l=null==(s=e.task)?void 0:s.taskId)?l:""],r=S[null!=(i=null==(a=t.task)?void 0:a.taskId)?i:""];return n&&r?sb.c9.fromISO(r).diff(sb.c9.fromISO(n)).toMillis():n?-1:1*!!r})}return 2===z?X.filter(e=>{var t;return!(null==(t=e.task)?void 0:t.isActive)}):[]},[X,z,S]);if((0,p.useEffect)(()=>{var e;let t=v?null==X?void 0:X.find(e=>{var t;return(null==(t=e.task)?void 0:t.taskId)===v}):void 0;t&&t.task&&(null==(e=t.schedules)?void 0:e.at(0))&&n(t),v||n(void 0)},[X,n,v]),(0,p.useEffect)(()=>()=>{n(void 0)},[n]),!P)return(0,sI.redirect)("/");let en=0===z&&el.length<=2;return(0,a.jsxs)("div",{className:(0,o.cn)("h-dvh w-full relative selection:bg-highlight",{"overflow-y-auto":u}),children:[(0,a.jsx)(T.hx,{hideIncognito:!0}),(0,a.jsx)(j.CommandMenu,{}),(0,a.jsxs)("div",{className:"max-w-[50rem] px-2 pt-16 @sm:pt-18 mx-auto w-full flex flex-col h-full items-center pb-4",style:k?{}:{maskImage:eS.pA,WebkitMaskImage:eS.pA},children:[(0,a.jsx)("div",{className:"flex justify-between align-center mt-6 min-h-[42px] w-full",children:(0,a.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 group",children:[(0,a.jsxs)("h1",{className:"text-2xl flex gap-2 items-center",children:[(0,a.jsx)(sh.A,{size:24,className:"min-w-8"}),(0,a.jsx)("span",{className:"font-semibold tracking-tight",children:t("tasks.page-title","Tasks")})]}),(0,a.jsx)(r.$n,{size:"iconSm",variant:"ghost",disabled:$||G,onClick:J,className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:(0,a.jsx)(eh.A,{size:14,"aria-label":t("task-results.refresh","refresh task results")})})]}),!u&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"absolute left-1/2 -translate-x-1/2",children:(0,a.jsx)(ee,{})}),(0,a.jsxs)(r.$n,{variant:"outline",onClick:et,size:"md",className:"px-4",children:[(0,a.jsx)(ei.A,{size:16}),(0,a.jsx)("span",{className:"font-semibold",children:t("tasks.create","Add new")})]})]})]})}),u&&(0,a.jsxs)("div",{className:"flex w-full justify-between items-center pb-4",children:[(0,a.jsx)(ee,{}),(0,a.jsxs)(r.$n,{variant:"outline",onClick:et,size:"md",children:[(0,a.jsx)(ei.A,{size:16}),t("tasks.create","Add new")]})]}),$?(0,a.jsx)("div",{className:"grow shrink self-stretch flex items-center justify-center",children:(0,a.jsx)(q.y,{size:"sm"})}):(0,a.jsxs)("div",{className:"pt-6 w-full overflow-auto relative no-scrollbar",style:I?{}:{maskImage:eS.l1,WebkitMaskImage:eS.l1},ref:y,children:[0===el.length&&0===z&&(0,a.jsx)(es,{}),0===el.length&&2===z&&(0,a.jsx)(ea,{}),(0,a.jsxs)("div",{className:(0,o.cn)("flex flex-col gap-4 pb-4 w-full "),children:[el.length>0&&el.filter(e=>!!e.task).map((e,t)=>{if(e.task){var s;return(0,a.jsx)(f.P.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},transition:{type:"ease",ease:"easeInOut",duration:.166,delay:.07*(t+1)},children:(0,a.jsx)(sS,{task:e,updateTaskIdIsUnread:E})},null==(s=e.task)?void 0:s.taskId)}}),en?(0,a.jsx)("div",{className:(0,o.cn)("pt-4 flex items-center pb-20",{"flex-col pb-8":u}),children:(0,a.jsx)("div",{className:(0,o.cn)("flex w-full gap-4",{"flex-col":u}),children:d.map((e,t)=>(0,a.jsx)(sk,{task:e},t))})}):null]})]})]})]})}function sS(e){var t,s,l,i,n,r,d,u,m,f;let{task:h,updateTaskIdIsUnread:v}=e,{t:j}=(0,g.Bd)("tasks"),{onSetSelectedTask:b}=(0,su.ek)(),{getNextRunLabel:y}=(0,su.Ik)(),{client:I}=(0,c.useStatsigClient)(),{resolvedTheme:w}=(0,sy.D)(),k=(0,eG.Di)(),N=(0,sf.d)(x.A("selectedTaskForSidePanel")),C=(null==N||null==(t=N.task)?void 0:t.taskId)===(null==(s=h.task)?void 0:s.taskId),S=(0,L.h)(),A=(0,p.useCallback)(()=>{var e;if(I.logEvent("clicked_tasks_card",void 0,{}),C)return b(void 0);b(null==(e=h.task)?void 0:e.taskId)},[C,b,I,null==(l=h.task)?void 0:l.taskId]),E=null==(i=h.schedules)?void 0:i.at(0),{data:z}=(0,sx.IT)({queryKey:["latest-task-result",null==(n=h.task)?void 0:n.taskId],queryFn:async()=>{var e;if(!(null==(e=h.task)?void 0:e.taskId))throw Error("TaskId is required");return sm.Cs.grokTasksGetLatestUnreadTaskResult({taskId:h.task.taskId})},enabled:S.ENABLE_GROK_TASKS&&!!(null==(r=h.task)?void 0:r.taskId),staleTime:0,refetchOnMount:"always"}),R=null==z||null==(d=z.results)?void 0:d.at(0),M=!(null==(u=h.task)?void 0:u.isActive),T=!!(R&&!R.isRead&&!M),D=null==R?void 0:R.createTime;if((0,p.useEffect)(()=>{var e,t;v(null!=(t=null==(e=h.task)?void 0:e.taskId)?t:"",D)},[v,null==(m=h.task)?void 0:m.taskId,D]),!h.task||!E)return null;let _=!!((null==(f=h.task)?void 0:f.isActive)&&E.isEnabled);return(0,a.jsxs)("div",{className:(0,o.cn)("w-full flex flex-col p-4 rounded-2xl border bg-surface-l1 hover:bg-surface-l2 cursor-pointer  relative",{"hover:bg-surface-inset":"light"===w},{"bg-surface-l2 hover:bg-surface-l3":C},{"bg-surface-inset hover:bg-button-ghost-hover":C&&"light"===w}),onClick:A,children:[(0,a.jsx)("div",{className:"flex flex-row items-center",children:(0,a.jsx)("h1",{className:(0,o.cn)("text-sm font-semibold w-full",{"text-xs":k}),children:h.task.name&&h.task.name.length>0?h.task.name:"Task"})}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:(0,o.cn)("flex items-center gap-1 text-sm font-medium text-fg-secondary",{"text-yellow-300":!_&&!M,"text-xs":k}),children:[M?(0,a.jsx)(sg.A,{size:14}):_?(0,a.jsx)(sv.A,{size:14,className:"text-fg-positive"}):(0,a.jsx)(sj.A,{size:14}),M?j("task-card.archived","Archived"):_?j("task-card.scheduled","Scheduled"):j("task-card.not-scheduled","Paused")]}),(0,a.jsx)("p",{className:(0,o.cn)("text-sm text-fg-secondary font-normal",{"text-xs":k}),children:_&&E.nextRun&&E.taskCadence&&"".concat(j("task-cadence.next-run","Next Run:")," ").concat(y(E.nextRun,E.isCompleted))})]}),(0,a.jsx)(P.N,{children:!k&&T&&R&&(0,a.jsx)("div",{className:"w-full mt-2",children:(0,a.jsx)(sA,{taskResult:R})})})]})}function sA(e){var t;let{taskResult:s}=e,{t:l}=(0,g.Bd)("tasks"),{client:i}=(0,c.useStatsigClient)(),{push:n}=(0,C.wK)(),d=(0,eG.Di)(),u=(0,p.useCallback)(e=>{i.logEvent("clicked_latest_unread_in_tasks_card",void 0,{}),(null==s?void 0:s.conversationId)&&(e.stopPropagation(),n({page:"chat",conversationId:null==s?void 0:s.conversationId,temporary:!1}))},[n,i,s]),m=(0,p.useMemo)(()=>{var e;if(!s.createTime)return null;let t=sb.c9.fromISO(s.createTime),a=sb.c9.now();return null!=(e=t.toRelative({base:a}))?e:l("just-now","Just now")},[l,s.createTime]);return(0,a.jsx)(f.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeIn"},children:(0,a.jsxs)(r.gx,{variant:"none",className:(0,o.cn)("cursor-pointer hover:bg-button-ghost-hover bg-surface-l3 border py-5 px-3 rounded-lg flex items-center justify-between w-full text-sm",{"flex-col items-start p-3":d}),onClick:u,tooltipContent:l("task-card.goto-last-chat-unread","Go to latest unread chat"),tooltipContentProps:{side:"bottom"},children:[(0,a.jsxs)("div",{className:(0,o.cn)("flex items-center gap-2",{"justify-between w-full":d}),children:[!d&&(0,a.jsx)(sc.x,{variant:"sm"}),(0,a.jsx)("p",{children:null!=(t=s.title)?t:l("new-task-result-label","New task result")}),d&&(0,a.jsx)(sc.x,{variant:"sm"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1.5 text-fg-secondary",children:[(0,a.jsx)("p",{className:(0,o.cn)({"text-xs":d}),children:m}),!d&&(0,a.jsx)(eI.A,{size:14})]})]})})}function sE(){let{route:e,push:t}=(0,C.wK)();(0,p.useEffect)(()=>h.aP.subscribe((s,a)=>{if(!s.conversationId||s.conversationId===a.conversationId||"chat"===e.page&&e.conversationId!==s.conversationId||"main"!==e.page)return;let l=e4.C$.getState().isIncognito;t({page:"chat",conversationId:l?null:s.conversationId,temporary:l})}),[t,e]);let{ENABLE_FILES_PAGE:s}=(0,L.h)(),{route:l}=(0,C.wK)();switch(l.page){case"main":case"chat":return(0,a.jsx)(sd.A,{});case"workspace":return(0,a.jsx)(so.w8,{workspaceId:l.workspaceId});case"workspaces":return(0,a.jsx)(so.TP,{});case"files":if(s)return(0,a.jsx)(sn,{});return(0,a.jsx)(U,{});case"tasks":return(0,a.jsx)(sC,{});case"images":return"Page "+l.page;default:return(0,a.jsx)(F.default,{})}}},56115:(e,t,s)=>{"use strict";s.d(t,{R:()=>l});var a=s(88382);let l=e=>{let{hasNextPage:t,isFetchingNextPage:s,isLoading:l,fetchNextPage:i}=e,n=(0,a.useRef)(null),r=(0,a.useRef)(null),[o,d]=(0,a.useState)(!1),[c,u]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{if(!(null==n?void 0:n.current)||!(null==r?void 0:r.current))return;let e=new IntersectionObserver(e=>{let[t]=e;d(t.isIntersecting)},{root:r.current,rootMargin:"300px 0px 300px 0px",threshold:.1}),t=n.current;return e.observe(t),()=>{t&&e.unobserve(t)}},[]),(0,a.useLayoutEffect)(()=>{!o||!t||s||c||l||(u(!0),i())},[o,t,s,i,c,l]),(0,a.useEffect)(()=>{if(c){let e=setTimeout(()=>{u(!1)},300);return()=>clearTimeout(e)}},[c]),{loadMoreRef:n,historyContainerRef:r}}},70154:(e,t,s)=>{Promise.resolve().then(s.bind(s,40865))},85255:(e,t,s)=>{"use strict";s.d(t,{H:()=>u});var a=s(42419),l=s(52265),i=s(77232),n=s(87891),r=s(20337),o=s(88382),d=s(65146),c=s(14908);let u=e=>{let{assetId:t,content:s,filename:u}=e,{client:m}=(0,r.useStatsigClient)(),f=(0,n.R)(e=>e.shareAsset),x=(0,n.R)(e=>e.cloneAsset),[p,g]=(0,o.useState)(!1),[h,v]=(0,o.useState)(!1),[j,b]=(0,o.useState)(!1),{t:y}=(0,d.Bd)("files"),I=(0,o.useCallback)(async()=>{m.logEvent("file_content_copy_click",void 0,{contentType:"text/markdown"}),s&&(await (0,a.L)(s),setTimeout(()=>{g(!1)},1e3),g(!0),c.oR.success(y("files.content.copied","Copied")))},[s,m,y]),w=(0,o.useCallback)(()=>{m.logEvent("file_content_download_click",void 0,{contentType:"text/markdown"});let e=new Blob([s],{type:"text/markdown"});(0,l.W)(e,u)},[m,s,u]);return{handleCopy:I,copyPressed:p,handleDownload:w,handleShare:(0,o.useCallback)(async()=>{if(m.logEvent("file_content_share_click",void 0,{contentType:"text/markdown"}),!t)return;v(!0);let e=!1;try{await f(t),e=!0}catch(e){c.oR.error(y("Failed to share file.","Failed to share file."))}finally{v(!1)}if(!e)return;setTimeout(()=>{b(!1)},1e3),b(!0);let s=window.location.origin+"/shared-file/"+t;(0,i.g)(s,y("Copied share link to clipboard.","Copied share link to clipboard."))},[m,t,f,y]),sharePressed:j,shareLoading:h,handleClone:(0,o.useCallback)(async()=>{if(m.logEvent("file_content_clone_click",void 0,{contentType:"text/markdown"}),!t)return;let{assetId:e}=await x(t);e&&(window.location.href="/files/?file=".concat(e))},[m,t,x])}}},87549:(e,t,s)=>{"use strict";s.d(t,{B:()=>o});var a=s(79342),l=s(16538),i=s(34323),n=s(16506),r=s(88382);let o=e=>{let{syntax:t,value:s,isStreaming:o,editable:d,autofocus:c,onContentUpdate:u}=e,m=(0,r.useRef)(void 0),[f,x]=(0,r.useState)(!1),p=(0,r.useRef)(null),{resolvedTheme:g}=(0,n.D)();(0,r.useEffect)(()=>{(0,l.q)()},[]);let h=(0,r.useCallback)((e,t)=>{t.isFlush||u(e)},[u]),v=(0,r.useCallback)(e=>{p.current=e,x(!0)},[]);(0,r.useEffect)(()=>{let e=p.current;if(f&&e&&d&&c){var t,s;let a={lineNumber:1,column:(null!=(s=null==(t=e.getModel())?void 0:t.getLineLength(1))?s:0)+1};e.setPosition(a),e.focus()}},[f,c]),(0,r.useEffect)(()=>{let e=p.current;if(!e||!l.x||!o)return;let t=e.getValue(),a=e.getModel();if(!a)return;if(!s.includes(t))return void e.setValue(s);let i=s.substring(t.length),n=a.getPositionAt(t.length);e.executeEdits("stream-update",[{range:new l.x.Range(n.lineNumber,n.column,n.lineNumber,n.column),forceMoveMarkers:!0,text:i}])},[f,s,o]);let j=(0,r.useCallback)(()=>{m.current&&m.current();let e=null===l.x||void 0===l.x?void 0:l.x.editor.getEditors()[0];if(e){var t;let s=e.getSelection();if(!s)return;if(null==(t=e.getModel())?void 0:t.getValueInRange(s)){let t=document.createElement("div"),a={getId:()=>"selected-text.widget",getDomNode:()=>t,getPosition:()=>l.x?{position:{lineNumber:s.endLineNumber,column:s.startColumn},preference:[l.x.editor.ContentWidgetPositionPreference.BELOW,l.x.editor.ContentWidgetPositionPreference.ABOVE]}:{position:{lineNumber:s.endLineNumber,column:s.startColumn},preference:[]}};e.addContentWidget(a),m.current=()=>e.removeContentWidget(a)}}},[]),b=(0,r.useMemo)(()=>({contextmenu:!1,suggestOnTriggerCharacters:!1,acceptSuggestionOnEnter:"off",lineNumbers:"on",readOnly:!d,quickSuggestions:!1,fontFamily:"var(--font-ibm-plex-mono)",fontSize:14,stickyScroll:{enabled:!1},wordBasedSuggestions:"off",wordWrap:"on",automaticLayout:!0,parameterHints:{enabled:!1},hover:{enabled:!1},minimap:{enabled:!1},scrollbar:{useShadows:!1},scrollBeyondLastLine:!1,padding:{bottom:30}}),[d]),y=(0,r.useCallback)(e=>{e.languages.register({id:"latex"}),e.languages.setMonarchTokensProvider("latex",{tokenizer:{root:[[/[\\][a-zA-Z]+/,"keyword"],[/\$[^$]*\$/,"string"],[/\\[\(\[][^{}]*\\[\)\]]/,"string"],[/%.*$/,"comment"],[/[{}]/,"delimiter"],[/\\(begin|end)\{[a-zA-Z]*\}/,"keyword"],[/[\[\]()]/,"delimiter"]]}})},[]);return(0,a.jsx)("div",{className:"w-full h-full max-h-full",onMouseUp:j,children:(0,a.jsx)(i.Ay,{height:"100%",width:"100%",onMount:v,value:o?void 0:s,language:t,onChange:h,beforeMount:y,theme:"dark"===g?"dark":"light",options:b})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[20936,51829,64713,28422,94150,4684,55701,37866,26294,77186,58895,18096,24657,19004,72781,52160,67303,66432,65146,53592,5743,87786,33846,23551,41272,93038,73466,43303,24823,49972,10953,52401,5861,13504,8978,98096,14987,47610,20204,77358],()=>t(70154)),_N_E=e.O()}]);